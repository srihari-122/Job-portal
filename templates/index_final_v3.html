<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Job Portal - Connect Talent with Opportunity - v3.0</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="/static/css/style.css?v=20241208" rel="stylesheet">
    <style>
        /* Custom Animations and UI Enhancements */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }
        
        @keyframes shimmer {
            0% {
                background-position: -200px 0;
            }
            100% {
                background-position: calc(200px + 100%) 0;
            }
        }
        
        .animate-fadeInUp {
            animation: fadeInUp 0.6s ease-out;
        }
        
        .animate-slideInLeft {
            animation: slideInLeft 0.6s ease-out;
        }
        
        .animate-slideInRight {
            animation: slideInRight 0.6s ease-out;
        }
        
        .animate-pulse-slow {
            animation: pulse 2s infinite;
        }
        
        /* Improved text contrast for better visibility */
        .text-contrast {
            color: #1f2937 !important;
            font-weight: 500;
        }
        
        .bg-contrast {
            background-color: #f3f4f6 !important;
            border: 1px solid #d1d5db;
        }
        
        .score-text {
            color: #ffffff !important;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
            font-weight: bold;
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .gradient-bg-alt {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        
        .gradient-bg-success {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        
        .shimmer {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200px 100%;
            animation: shimmer 1.5s infinite;
        }
        
        .floating {
            animation: floating 3s ease-in-out infinite;
        }
        
        @keyframes floating {
            0%, 100% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(-10px);
            }
        }
        
        .dashboard-card {
            background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
            border: 1px solid rgba(226, 232, 240, 0.8);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .dashboard-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            border-color: rgba(59, 130, 246, 0.3);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }
        
        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }
        
        .btn-primary:hover::before {
            left: 100%;
        }
        
        .stats-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            position: relative;
            overflow: hidden;
        }
        
        .stats-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.1) 50%, transparent 70%);
            transform: translateX(-100%);
            transition: transform 0.6s;
        }
        
        .stats-card:hover::before {
            transform: translateX(100%);
        }
        
        .loading-skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200px 100%;
            animation: shimmer 1.5s infinite;
        }
        
        .nav-link {
            position: relative;
            transition: all 0.3s ease;
        }
        
        .nav-link::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            bottom: -5px;
            left: 50%;
            background: #667eea;
            transition: all 0.3s ease;
        }
        
        .nav-link:hover::after {
            width: 100%;
            left: 0;
        }
        
        .progress-bar {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }
        
        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background-image: linear-gradient(
                -45deg,
                rgba(255, 255, 255, 0.2) 25%,
                transparent 25%,
                transparent 50%,
                rgba(255, 255, 255, 0.2) 50%,
                rgba(255, 255, 255, 0.2) 75%,
                transparent 75%,
                transparent
            );
            background-size: 50px 50px;
            animation: move 2s linear infinite;
        }
        
        @keyframes move {
            0% {
                background-position: 0 0;
            }
            100% {
                background-position: 50px 50px;
            }
        }
        
        /* Dashboard Navigation Styles */
        .dashboard-section {
            transition: all 0.3s ease;
        }
        
        .dashboard-section.hidden {
            display: none;
        }
        
        .nav-item {
            position: relative;
            overflow: hidden;
        }
        
        .nav-item.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        
        .nav-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        /* Fix for Upload Resume Icons */
        .upload-icon {
            filter: none !important;
            opacity: 1 !important;
            visibility: visible !important;
        }
        
        .fas.fa-upload {
            opacity: 1 !important;
            visibility: visible !important;
            color: #10b981 !important;
            font-weight: 900 !important;
        }
        
        .fas.fa-file-upload {
            opacity: 1 !important;
            visibility: visible !important;
            color: #10b981 !important;
            font-weight: 900 !important;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        /* Ensure all icons are visible */
        .fas, .far, .fab {
            opacity: 1 !important;
            visibility: visible !important;
        }
        
        /* Upload Resume Card Enhancements */
        .resume-upload-icon-wrapper {
            position: relative;
            animation: iconPulse 2s ease-in-out infinite;
        }
        
        @keyframes iconPulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }
        
        .resume-upload-highlight {
            border: 3px solid #1e293b !important;
            box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.2) !important;
        }
        
        /* ========== ENHANCED STAT CARDS ========== */
        .stat-card {
            position: relative;
            overflow: hidden;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        
        .stat-card:hover::before {
            opacity: 1;
        }
        
        .stat-card:hover {
            transform: translateY(-10px) scale(1.03);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }
        
        /* ========== ENHANCED JOB CARDS ========== */
        .job-card {
            background: white;
            border-radius: 20px;
            padding: 24px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07);
            border: 2px solid rgba(226, 232, 240, 0.6);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .job-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transform: scaleX(0);
            transition: transform 0.4s ease;
        }
        
        .job-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(102, 126, 234, 0.15);
            border-color: rgba(102, 126, 234, 0.4);
        }
        
        .job-card:hover::before {
            transform: scaleX(1);
        }
        
        /* ========== ENHANCED ACTION CARDS ========== */
        .action-card {
            position: relative;
            overflow: hidden;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .action-card::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(102, 126, 234, 0.1) 0%, transparent 70%);
            transform: translate(-50%, -50%);
            transition: width 0.6s ease, height 0.6s ease;
            pointer-events: none;
        }
        
        .action-card:hover::after {
            width: 500px;
            height: 500px;
        }
        
        /* ========== ENHANCED ICON CONTAINERS ========== */
        .icon-container {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .dashboard-card:hover .icon-container {
            transform: scale(1.15) rotate(5deg);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }
        
        /* ========== ENHANCED BUTTON STYLES ========== */
        .btn-enhanced {
            position: relative;
            overflow: hidden;
            z-index: 1;
        }
        
        .btn-enhanced::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s ease, height 0.6s ease;
            z-index: -1;
        }
        
        .btn-enhanced:hover::after {
            width: 300px;
            height: 300px;
        }
        
        /* ========== ENHANCED BADGE STYLES ========== */
        .badge-modern {
            display: inline-flex;
            align-items: center;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 700;
            border: 2px solid;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .badge-modern::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: left 0.5s;
        }
        
        .badge-modern:hover {
            transform: scale(1.1) translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        
        .badge-modern:hover::before {
            left: 100%;
        }
        
        /* ========== ENHANCED SKILLS CONTAINER ========== */
        .skills-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 12px;
        }
        
        .skill-chip {
            display: inline-flex;
            align-items: center;
            background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%);
            color: #4338ca;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            border: 2px solid #c7d2fe;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: default;
        }
        
        .skill-chip:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 6px 16px rgba(67, 56, 202, 0.25);
            border-color: #818cf8;
        }
        
        /* ========== ENHANCED FORM ELEMENTS ========== */
        .form-control-modern {
            padding: 14px 20px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 15px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            width: 100%;
        }
        
        .form-control-modern:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.15);
            transform: translateY(-2px);
        }
        
        /* ========== ENHANCED NAVBAR ========== */
        .navbar-modern {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07);
        }
        
        /* ========== ENHANCED CONTAINER ========== */
        .container-modern {
            position: relative;
            z-index: 1;
        }
        
        /* ========== ENHANCED TABLE ROWS ========== */
        .table-row-modern {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }
        
        .table-row-modern::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transform: scaleY(0);
            transition: transform 0.3s ease;
        }
        
        .table-row-modern:hover {
            background: linear-gradient(90deg, #faf5ff 0%, #f3e8ff 100%);
            transform: translateX(8px);
        }
        
        .table-row-modern:hover::before {
            transform: scaleY(1);
        }
        
        /* ========== ENHANCED ANIMATIONS ========== */
        @keyframes bounceIn {
            0% {
                opacity: 0;
                transform: scale(0.3);
            }
            50% {
                opacity: 1;
                transform: scale(1.05);
            }
            70% {
                transform: scale(0.9);
            }
            100% {
                transform: scale(1);
            }
        }
        
        .animate-bounceIn {
            animation: bounceIn 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        @keyframes slideInFromLeft {
            from {
                opacity: 0;
                transform: translateX(-100px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .animate-slideInFromLeft {
            animation: slideInFromLeft 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        @keyframes slideInFromRight {
            from {
                opacity: 0;
                transform: translateX(100px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .animate-slideInFromRight {
            animation: slideInFromRight 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        @keyframes zoomIn {
            from {
                opacity: 0;
                transform: scale(0.5);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        .animate-zoomIn {
            animation: zoomIn 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* ========== ENHANCED GRID ITEMS ========== */
        .grid-item-modern {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .grid-item-modern:hover {
            transform: translateY(-8px);
            z-index: 10;
        }
        
        /* ========== ENHANCED LOADING STATES ========== */
        .skeleton-loader {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }
        
        /* ========== ENHANCED HOVER EFFECTS ========== */
        .hover-lift {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .hover-lift:hover {
            transform: translateY(-6px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
        }
        
        .hover-scale {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .hover-scale:hover {
            transform: scale(1.05);
        }
        
        .hover-glow:hover {
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.5);
        }
        
        /* ========== PROFESSIONAL STAT CARDS ========== */
        .stat-card-professional {
            position: relative;
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .stat-card-professional::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 120px;
            height: 120px;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.15) 0%, transparent 70%);
            border-radius: 50%;
            transform: translate(30%, -30%);
        }
        
        .stat-card-professional:hover {
            transform: translateY(-10px) scale(1.03);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.2);
        }
        
        /* ========== PROFESSIONAL ICON BADGES ========== */
        .icon-badge-professional {
            position: relative;
            z-index: 1;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .icon-badge-professional::after {
            content: '';
            position: absolute;
            inset: -3px;
            background: linear-gradient(45deg, rgba(102, 126, 234, 0.4), rgba(118, 75, 162, 0.4));
            border-radius: inherit;
            opacity: 0;
            transition: opacity 0.4s ease;
            z-index: -1;
        }
        
        .icon-badge-professional:hover::after {
            opacity: 1;
        }
        
        /* ========== PROFESSIONAL CONTENT SECTIONS ========== */
        .content-section-professional {
            background: white;
            border-radius: 24px;
            padding: 32px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 2px solid rgba(226, 232, 240, 0.6);
            margin-bottom: 24px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .content-section-professional:hover {
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.12);
            border-color: rgba(102, 126, 234, 0.3);
        }
        
        /* ========== PROFESSIONAL TITLE BARS ========== */
        .title-bar-professional {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 20px 0;
            border-bottom: 3px solid;
            border-image: linear-gradient(90deg, #667eea 0%, #764ba2 100%) 1;
            margin-bottom: 28px;
        }
        
        .title-bar-professional h2 {
            font-size: 1.75rem;
            font-weight: 800;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.5px;
        }
        
        /* ========== PROFESSIONAL LIST ITEMS ========== */
        .list-item-professional {
            padding: 16px 20px;
            border-radius: 12px;
            margin-bottom: 12px;
            background: white;
            border: 2px solid #e5e7eb;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }
        
        .list-item-professional::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            width: 5px;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px 0 0 12px;
            transform: scaleY(0);
            transition: transform 0.3s ease;
        }
        
        .list-item-professional:hover {
            background: linear-gradient(90deg, #f8fafc 0%, white 100%);
            border-color: rgba(102, 126, 234, 0.3);
            transform: translateX(8px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }
        
        .list-item-professional:hover::before {
            transform: scaleY(1);
        }
        
        /* ========== PROFESSIONAL SECTION DIVIDERS ========== */
        .section-divider-professional {
            height: 3px;
            background: linear-gradient(90deg, transparent 0%, #667eea 50%, transparent 100%);
            margin: 40px 0;
            border-radius: 3px;
        }
        
        /* ========== PROFESSIONAL INFO BOXES ========== */
        .info-box-professional {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border-left: 5px solid #3b82f6;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.1);
        }
        
        .success-box-professional {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border-left: 5px solid #10b981;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.1);
        }
        
        .warning-box-professional {
            background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
            border-left: 5px solid #f59e0b;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.1);
        }
        
        /* ========== PROFESSIONAL EMPTY STATE ========== */
        .empty-state-professional {
            text-align: center;
            padding: 60px 40px;
            background: linear-gradient(145deg, #f8fafc 0%, white 100%);
            border-radius: 20px;
            border: 2px dashed #cbd5e1;
        }
        
        .empty-state-professional i {
            font-size: 4rem;
            color: #cbd5e1;
            margin-bottom: 20px;
        }
        
        .empty-state-professional h3 {
            font-size: 1.5rem;
            font-weight: 700;
            color: #475569;
            margin-bottom: 12px;
        }
        
        .empty-state-professional p {
            color: #64748b;
            font-size: 1rem;
        }
        
        /* ========== PROFESSIONAL LOADING STATE ========== */
        .loading-professional {
            display: inline-flex;
            align-items: center;
            gap: 12px;
            padding: 16px 28px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 50px;
            font-weight: 700;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        
        .loading-professional .spinner {
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-white shadow-lg sticky top-0 z-50 backdrop-blur-md bg-white/90">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0 animate-slideInLeft">
                        <h1 class="text-2xl font-bold text-blue-600">
                            <i class="fas fa-briefcase mr-2"></i>JobPortal
                        </h1>
                    </div>
                </div>
                <div class="flex items-center space-x-4 animate-slideInRight">
                    <button id="loginBtn" class="btn-primary text-white px-6 py-2 rounded-full font-semibold shadow-lg" onclick="showLoginModal();">
                        <i class="fas fa-sign-in-alt mr-2"></i>Login
                    </button>
                    <button id="registerBtn" class="bg-green-500 text-white px-6 py-2 rounded-full font-semibold shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105 hover:bg-green-600" onclick="showRegisterModal();">
                        <i class="fas fa-user-plus mr-2"></i>Register
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Homepage Content -->
    <div id="homepageContent">
        <!-- Hero Section -->
        <div class="hero-section relative bg-gradient-to-br from-blue-600 via-purple-600 to-indigo-700 text-white py-32 px-4 text-center overflow-hidden">
            <!-- Animated Background Particles -->
            <div class="hero-particles">
                <div class="particle particle-1"></div>
                <div class="particle particle-2"></div>
                <div class="particle particle-3"></div>
                <div class="particle particle-4"></div>
                <div class="particle particle-5"></div>
                <div class="particle particle-6"></div>
            </div>
            
            <!-- Animated Waves -->
            <div class="hero-waves">
                <svg class="wave wave-1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320">
                    <path fill="rgba(255,255,255,0.05)" d="M0,160L48,176C96,192,192,224,288,224C384,224,480,192,576,165.3C672,139,768,117,864,122.7C960,128,1056,160,1152,165.3C1248,171,1344,149,1392,138.7L1440,128L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path>
                </svg>
                <svg class="wave wave-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320">
                    <path fill="rgba(255,255,255,0.03)" d="M0,64L48,85.3C96,107,192,149,288,154.7C384,160,480,128,576,112C672,96,768,96,864,112C960,128,1056,160,1152,154.7C1248,149,1344,107,1392,85.3L1440,64L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path>
                </svg>
            </div>
            
            <div class="max-w-6xl mx-auto relative z-10">
                <div class="hero-badge mb-6">
                    <i class="fas fa-rocket mr-2"></i>AI-Powered Job Portal
                </div>
                <h1 class="hero-title text-7xl md:text-8xl font-black mb-6">
                    Find Your <span class="hero-gradient-text">Dream Job</span>
                </h1>
                <p class="hero-subtitle text-2xl mb-12 opacity-95 max-w-3xl mx-auto">
                    Connect with top companies and discover opportunities tailored to your unique skills with our AI-powered matching system
                </p>
                <div class="hero-buttons flex flex-wrap justify-center gap-6">
                    <button id="browseJobsBtn" class="hero-btn hero-btn-primary">
                        <span class="hero-btn-icon"><i class="fas fa-search"></i></span>
                        <span class="hero-btn-text">Browse Jobs</span>
                        <span class="hero-btn-shine"></span>
                    </button>
                    <button id="postJobBtn" class="hero-btn hero-btn-secondary">
                        <span class="hero-btn-icon"><i class="fas fa-plus"></i></span>
                        <span class="hero-btn-text">Post a Job</span>
                        <span class="hero-btn-shine"></span>
                    </button>
                </div>
                
                <!-- Stats Section -->
                <div class="hero-stats grid grid-cols-1 md:grid-cols-3 gap-8 mt-20">
                    <div class="stat-item">
                        <div class="stat-number">500+</div>
                        <div class="stat-label">Active Jobs</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">95%</div>
                        <div class="stat-label">Success Rate</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">10K+</div>
                        <div class="stat-label">Happy Users</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Why Choose Us Section -->
        <div class="features-section py-24 bg-gradient-to-b from-gray-50 to-white px-4">
            <div class="max-w-7xl mx-auto">
                <div class="text-center mb-16">
                    <h2 class="features-title text-5xl font-extrabold text-gray-900 mb-4">
                        Why Choose <span class="text-gradient">Our Platform</span>?
                    </h2>
                    <p class="features-subtitle text-xl text-gray-600 max-w-2xl mx-auto">
                        Experience the future of job searching with our cutting-edge AI technology
                    </p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-10">
                    <div class="feature-card-modern">
                        <div class="feature-icon-wrapper bg-gradient-to-br from-purple-500 to-indigo-600">
                            <i class="fas fa-robot text-white text-3xl"></i>
                        </div>
                        <h3 class="feature-card-title text-2xl font-bold text-gray-900 mt-6 mb-3">
                            AI Career Analysis
                        </h3>
                        <p class="feature-card-text text-gray-600 leading-relaxed">
                            Get personalized career insights, skill gap analysis, and growth recommendations powered by advanced AI algorithms
                        </p>
                        <div class="feature-card-glow"></div>
                    </div>
                    <div class="feature-card-modern">
                        <div class="feature-icon-wrapper bg-gradient-to-br from-blue-500 to-cyan-600">
                            <i class="fas fa-file-alt text-white text-3xl"></i>
                        </div>
                        <h3 class="feature-card-title text-2xl font-bold text-gray-900 mt-6 mb-3">
                            Smart Resume Processing
                        </h3>
                        <p class="feature-card-text text-gray-600 leading-relaxed">
                            Intelligent resume parsing and analysis that extracts key information and matches you with perfect opportunities
                        </p>
                        <div class="feature-card-glow"></div>
                    </div>
                    <div class="feature-card-modern">
                        <div class="feature-icon-wrapper bg-gradient-to-br from-green-500 to-emerald-600">
                            <i class="fas fa-chart-line text-white text-3xl"></i>
                        </div>
                        <h3 class="feature-card-title text-2xl font-bold text-gray-900 mt-6 mb-3">
                            Career Growth Insights
                        </h3>
                        <p class="feature-card-text text-gray-600 leading-relaxed">
                            Receive personalized recommendations for career paths, skill development, and salary projections
                        </p>
                        <div class="feature-card-glow"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="modal-overlay fixed inset-0 hidden z-50 flex items-center justify-center p-4">
        <div class="modal-backdrop absolute inset-0 bg-gradient-to-br from-purple-900/40 to-blue-900/40 backdrop-blur-sm" onclick="document.getElementById('closeLoginModal').click()"></div>
        <div class="modal-container bg-white/95 backdrop-blur-xl rounded-3xl p-10 w-full max-w-md relative transform transition-all">
            <div class="modal-glow"></div>
            <div class="flex justify-between items-center mb-8">
                <div>
                    <h2 class="modal-title text-3xl font-extrabold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">
                        Welcome Back
                    </h2>
                    <p class="text-gray-600 text-sm mt-1">Sign in to continue your journey</p>
                </div>
                <button id="closeLoginModal" class="modal-close text-gray-400 hover:text-gray-700 text-3xl transition-all hover:rotate-90">
                    ×
                </button>
            </div>
            <form id="loginForm" class="space-y-6">
                <div class="form-group-modern">
                    <label for="loginEmail" class="form-label-modern">Email Address</label>
                    <div class="form-input-wrapper">
                        <i class="fas fa-envelope form-input-icon"></i>
                        <input type="email" id="loginEmail" name="email" class="form-input-modern" placeholder="your@email.com" required>
                    </div>
                </div>
                <div class="form-group-modern">
                    <label for="loginPassword" class="form-label-modern">Password</label>
                    <div class="form-input-wrapper">
                        <i class="fas fa-lock form-input-icon"></i>
                        <input type="password" id="loginPassword" name="password" class="form-input-modern" placeholder="••••••••" required>
                    </div>
                </div>
                <button type="submit" class="btn-modern btn-modern-primary w-full">
                    <span class="btn-modern-text">Sign In</span>
                    <i class="fas fa-arrow-right btn-modern-icon"></i>
                </button>
                <div class="text-center pt-4">
                    <p class="text-gray-600 text-sm">
                        Don't have an account? 
                        <a href="#" id="switchToRegister" class="text-blue-600 hover:text-purple-600 font-semibold transition-colors">
                            Create Account
                        </a>
                    </p>
                </div>
            </form>
        </div>
    </div>

    <!-- Register Modal -->
    <div id="registerModal" class="modal-overlay fixed inset-0 hidden z-50 flex items-center justify-center p-4">
        <div class="modal-backdrop absolute inset-0 bg-gradient-to-br from-green-900/40 to-blue-900/40 backdrop-blur-sm" onclick="document.getElementById('closeRegisterModal').click()"></div>
        <div class="modal-container bg-white/95 backdrop-blur-xl rounded-3xl p-10 w-full max-w-md relative transform transition-all">
            <div class="modal-glow"></div>
            <div class="flex justify-between items-center mb-8">
                <div>
                    <h2 class="modal-title text-3xl font-extrabold bg-gradient-to-r from-green-600 to-blue-600 bg-clip-text text-transparent">
                        Create Account
                    </h2>
                    <p class="text-gray-600 text-sm mt-1">Join us and find your dream job</p>
                </div>
                <button id="closeRegisterModal" class="modal-close text-gray-400 hover:text-gray-700 text-3xl transition-all hover:rotate-90">
                    ×
                </button>
            </div>
            <form id="registerForm" class="space-y-5">
                <div class="form-group-modern">
                    <label for="registerFullName" class="form-label-modern">Full Name</label>
                    <div class="form-input-wrapper">
                        <i class="fas fa-user form-input-icon"></i>
                        <input type="text" id="registerFullName" name="name" class="form-input-modern" placeholder="John Doe" required>
                    </div>
                </div>
                <div class="form-group-modern">
                    <label for="registerEmail" class="form-label-modern">Email Address</label>
                    <div class="form-input-wrapper">
                        <i class="fas fa-envelope form-input-icon"></i>
                        <input type="email" id="registerEmail" name="email" class="form-input-modern" placeholder="your@email.com" required>
                    </div>
                </div>
                <div class="form-group-modern">
                    <label for="registerPhone" class="form-label-modern">Phone (optional)</label>
                    <div class="form-input-wrapper">
                        <i class="fas fa-phone form-input-icon"></i>
                        <input type="text" id="registerPhone" name="phone" class="form-input-modern" placeholder="+1 234 567 8900">
                    </div>
                </div>
                <div class="form-group-modern">
                    <label for="registerRole" class="form-label-modern">I am a</label>
                    <div class="form-input-wrapper">
                        <i class="fas fa-user-tag form-input-icon"></i>
                        <select id="registerRole" name="role" class="form-input-modern">
                            <option value="candidate">Job Seeker</option>
                            <option value="admin">Employer</option>
                        </select>
                    </div>
                </div>
                <div class="form-group-modern">
                    <label for="registerPassword" class="form-label-modern">Password</label>
                    <div class="form-input-wrapper">
                        <i class="fas fa-lock form-input-icon"></i>
                        <input type="password" id="registerPassword" name="password" class="form-input-modern" placeholder="••••••••" required>
                    </div>
                </div>
                <button type="submit" class="btn-modern btn-modern-success w-full">
                    <span class="btn-modern-text">Create Account</span>
                    <i class="fas fa-rocket btn-modern-icon"></i>
                </button>
                <div class="text-center pt-4">
                    <p class="text-gray-600 text-sm">
                        Already have an account? 
                        <a href="#" id="switchToLogin" class="text-green-600 hover:text-blue-600 font-semibold transition-colors">
                            Sign In
                        </a>
                    </p>
                </div>
            </form>
        </div>
    </div>

    <!-- Dashboard Container (hidden by default) -->
    <div id="dashboardContainer" class="hidden min-h-screen bg-gray-100">
        <!-- Dashboard content will be loaded here by JavaScript -->
    </div>

    <!-- Toast Notifications -->
    <div id="toastContainer" class="fixed top-4 right-4 z-50"></div>

    <script>
        // Check if user is already logged in
        function checkAuth() {
            const token = localStorage.getItem('token');
            const userStr = localStorage.getItem('user');
            
            if (token && userStr && userStr !== 'null' && userStr !== 'undefined') {
                try {
                    const user = JSON.parse(userStr);
                    if (user && user.email) {
                console.log('User is logged in, showing dashboard');
                showDashboard();
                        return;
                    }
                } catch (e) {
                    console.error('Error parsing user data:', e);
                }
            }
            
                console.log('User not logged in, showing homepage');
                showHomepage();
        }
        
        // Show homepage
        function showHomepage() {
            document.getElementById('homepageContent').style.display = 'block';
            document.querySelector('nav').style.display = 'block';
            document.getElementById('dashboardContainer').classList.add('hidden');
        }
        
        // Show dashboard based on user role
        async function showDashboard() {
            // Hide the homepage content (including "Why Choose Our Platform" section)
            document.getElementById('homepageContent').style.display = 'none';
            // Hide the navigation (login/register buttons)
            document.querySelector('nav').style.display = 'none';
            // Show the dashboard
            document.getElementById('dashboardContainer').classList.remove('hidden');
            
            const userStr = localStorage.getItem('user');
            const user = userStr && userStr !== 'null' && userStr !== 'undefined' ? JSON.parse(userStr) : {};
            const userRole = user.role || 'candidate';
            
            // Fetch fresh user data from API
            let freshUserData = user;
            try {
                const token = localStorage.getItem('token');
                if (token) {
                    const response = await fetch('http://localhost:8005/api/user-resume', {
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        freshUserData = {
                            ...user,
                            name: data.name || user.name,
                            email: data.email || user.email,
                            role: data.role || user.role
                        };
                        
                        // Update localStorage with fresh data
                        localStorage.setItem('user', JSON.stringify(freshUserData));
                    }
                }
            } catch (error) {
                console.error('Error fetching fresh user data:', error);
            }
            
            const userName = freshUserData.name || freshUserData.email || 'User';
            
             // Load user role from user data
             loadUserRole();
             
             if (userRole === 'admin') {
                 showAdminDashboard(userName, freshUserData);
             } else {
                 showCandidateDashboard(userName, freshUserData);
                 // Load profile data after dashboard is shown
                 setTimeout(async () => {
                     await loadProfileCard();
                 }, 1000);
                 
                 // Load resume status after dashboard loads
                 setTimeout(loadResumeStatus, 1500);
                 
                 // Ensure upload button is visible
                 setTimeout(ensureUploadButtonVisible, 2000);
                 
                 // Periodic check to ensure button stays visible
                 setInterval(ensureUploadButtonVisible, 5000);
             }
        }
        
        // Show Admin Dashboard
        function showAdminDashboard(userName, user) {
            document.getElementById('dashboardContainer').innerHTML = `
                <div class="min-h-screen" style="background: linear-gradient(135deg, #f0f4f8 0%, #e8edf2 100%);">
                    <!-- Professional Admin Header -->
                    <div class="admin-header text-white">
                        <div class="max-w-7xl mx-auto px-6 py-8 relative z-10">
                            <div class="flex justify-between items-center">
                                <div class="animate-slideInLeft">
                                    <div class="flex items-center gap-4 mb-2">
                                        <div class="w-14 h-14 bg-white/20 backdrop-blur-md rounded-2xl flex items-center justify-center shadow-xl">
                                            <i class="fas fa-shield-alt text-3xl"></i>
                                        </div>
                                        <div>
                                            <h1 class="text-4xl font-black tracking-tight">Admin Dashboard</h1>
                                            <p class="text-blue-100 mt-1 text-sm font-medium">Welcome back, ${userName}</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-4 animate-slideInRight">
                                    <div class="admin-badge bg-white/20 backdrop-blur-md border-2 border-white/30 text-white shadow-xl">
                                        <i class="fas fa-crown mr-2"></i>
                                        <span class="font-bold">Administrator</span>
                                    </div>
                                    <button onclick="logout()" class="btn-professional btn-professional-danger">
                                        <i class="fas fa-sign-out-alt mr-2"></i>Logout
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Admin Dashboard Content -->
                    <div class="max-w-7xl mx-auto py-8 px-4">
                        <!-- Dashboard Stats -->
                        <div id="adminStats" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                            <!-- Stats will be loaded here -->
                        </div>
                        
                        <!-- Professional Admin Action Cards -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                            <!-- Job Management Card -->
                            <div class="admin-action-card animate-fadeInUp">
                                <div class="flex items-center gap-4 mb-6">
                                    <div class="admin-icon-wrapper bg-gradient-to-br from-blue-500 to-blue-600 text-white shadow-lg">
                                        <i class="fas fa-briefcase text-2xl"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-xl font-bold text-gray-800">Job Management</h3>
                                        <p class="text-sm text-gray-500">Post & manage</p>
                                    </div>
                                </div>
                                <p class="text-gray-600 mb-6 leading-relaxed">Create, edit, and monitor all job listings across the platform</p>
                                <button onclick="showAdminJobsSection()" class="btn-professional btn-professional-primary w-full">
                                    <i class="fas fa-briefcase mr-2"></i>Manage Jobs
                                </button>
                            </div>
                            
                            <!-- Application Management Card -->
                            <div class="admin-action-card animate-fadeInUp" style="animation-delay: 0.1s;">
                                <div class="flex items-center gap-4 mb-6">
                                    <div class="admin-icon-wrapper bg-gradient-to-br from-slate-700 via-slate-800 to-slate-900 text-white shadow-lg border-2 border-pink-400">
                                        <i class="fas fa-file-alt text-2xl" style="color: #ec4899 !important;"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-xl font-bold text-gray-800">Applications</h3>
                                        <p class="text-sm text-gray-500">Review & track</p>
                                    </div>
                                </div>
                                <p class="text-gray-600 mb-6 leading-relaxed">Review, approve, and manage all candidate applications</p>
                                <button onclick="showAdminApplicationsSection()" class="btn-professional btn-professional-purple w-full">
                                    <i class="fas fa-file-alt mr-2"></i>View Applications
                                </button>
                            </div>
                            
                            <!-- User Management Card -->
                            <div class="admin-action-card animate-fadeInUp" style="animation-delay: 0.2s;">
                                <div class="flex items-center gap-4 mb-6">
                                    <div class="admin-icon-wrapper bg-gradient-to-br from-slate-700 via-slate-800 to-slate-900 text-white shadow-lg border-2 border-orange-400">
                                        <i class="fas fa-users text-2xl" style="color: #fb923c !important;"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-xl font-bold text-gray-800">User Management</h3>
                                        <p class="text-sm text-gray-500">Control access</p>
                                    </div>
                                </div>
                                <p class="text-gray-600 mb-6 leading-relaxed">View and manage all platform users and permissions</p>
                                <button onclick="showUserManagement()" class="btn-professional btn-professional-primary w-full">
                                    <i class="fas fa-users mr-2"></i>Manage Users
                                </button>
                            </div>
                            
                            <!-- Analytics Card -->
                            <div class="admin-action-card animate-fadeInUp" style="animation-delay: 0.3s;">
                                <div class="flex items-center gap-4 mb-6">
                                    <div class="admin-icon-wrapper bg-gradient-to-br from-indigo-500 to-indigo-600 text-white shadow-lg">
                                        <i class="fas fa-chart-line text-2xl"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-xl font-bold text-gray-800">Analytics</h3>
                                        <p class="text-sm text-gray-500">Data insights</p>
                                    </div>
                                </div>
                                <p class="text-gray-600 mb-6 leading-relaxed">View comprehensive analytics and platform insights</p>
                                <button onclick="showAdminAnalyticsSection()" class="btn-professional btn-professional-purple w-full">
                                    <i class="fas fa-chart-line mr-2"></i>View Analytics
                                </button>
                            </div>
                        </div>
                        
                        <!-- Dashboard Content Area -->
                        <div id="dashboardContent" class="mt-8">
                            <!-- Admin sections will be loaded here -->
                        </div>
                    </div>
                </div>
            `;
        }
        
        // Navigation Functions
        function showDashboardOverview() {
            hideAllSections();
            document.getElementById('dashboard-overview').classList.remove('hidden');
            updateNavigation('nav-overview');
        }
        
        async function showProfileSection() {
            hideAllSections();
            document.getElementById('dashboard-profile').classList.remove('hidden');
            updateNavigation('nav-profile');
            
            // Load profile content
            const profileSection = document.getElementById('dashboard-profile');
            if (profileSection.innerHTML.trim() === '<!-- Profile section content -->') {
                profileSection.innerHTML = `
                <div class="dashboard-card rounded-xl p-8 animate-fadeInUp">
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center space-x-3">
                            <div class="w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center text-white text-xl">
                                <i class="fas fa-user"></i>
                            </div>
                            <h2 class="text-2xl font-bold text-gray-800">My Profile</h2>
                        </div>
                    </div>
                    
                    <div class="bg-blue-50 p-6 rounded-lg border border-blue-200">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-blue-800">Profile Information</h3>
                            <button onclick="showEditProfileForm()" class="bg-blue-500 text-white px-4 py-2 rounded-lg font-semibold shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105 hover:bg-blue-600">
                                <i class="fas fa-edit mr-2"></i>Edit Profile
                            </button>
                        </div>
                        <div class="space-y-3">
                            <div class="flex items-center space-x-3">
                                <i class="fas fa-user text-gray-400"></i>
                                <span class="text-gray-700"><strong>Name:</strong> <span id="profileName">Loading...</span></span>
                            </div>
                            <div class="flex items-center space-x-3">
                                <i class="fas fa-envelope text-gray-400"></i>
                                <span class="text-gray-700"><strong>Email:</strong> <span id="profileEmail">Loading...</span></span>
                            </div>
                            <div class="flex items-center space-x-3">
                                <i class="fas fa-briefcase text-gray-400"></i>
                                <span class="text-gray-700"><strong>Role:</strong> <span id="profileRole">Loading...</span></span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            await loadProfileData();
            }
            
            // Load role for profile section
            await loadProfileRole();
        }
        
        function showAIAnalysisSection() {
            hideAllSections();
            document.getElementById('dashboard-analysis').classList.remove('hidden');
            updateNavigation('nav-analysis');
            
            // Load AI Analysis content
            document.getElementById('dashboard-analysis').innerHTML = `
                <div class="dashboard-card rounded-xl p-8 animate-fadeInUp">
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center space-x-3">
                            <div class="w-12 h-12 bg-indigo-500 rounded-full flex items-center justify-center text-white text-xl">
                                <i class="fas fa-robot"></i>
                            </div>
                            <h2 class="text-2xl font-bold text-gray-800">AI Analysis</h2>
                        </div>
                    </div>
                    
                    <div class="bg-indigo-50 p-6 rounded-lg border border-indigo-200 mb-6">
                        <h3 class="text-lg font-semibold text-indigo-800 mb-3">Advanced AI-powered career insights and recommendations</h3>
                        <div class="space-y-3">
                            <button onclick="runMLAnalysis()" class="w-full bg-indigo-500 text-white px-6 py-3 rounded-lg font-semibold shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105">
                                <i class="fas fa-robot mr-2"></i>AI Career Analysis
                            </button>
                        </div>
                    </div>
                    
                    <div id="aiAnalysisResults" class="hidden">
                        <!-- AI Analysis results will be displayed here -->
                    </div>
                </div>
            `;
        }
        
        
        function hideAllSections() {
            const sections = document.querySelectorAll('.dashboard-section');
            sections.forEach(section => {
                section.classList.add('hidden');
            });
        }
        
        function updateNavigation(activeId) {
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => {
                item.classList.remove('active');
                item.className = item.className.replace('bg-blue-500 text-white', 'text-gray-600 hover:bg-gray-100');
            });
            
            const activeItem = document.getElementById(activeId);
            if (activeItem) {
                activeItem.classList.add('active');
                activeItem.className = activeItem.className.replace('text-gray-600 hover:bg-gray-100', 'bg-blue-500 text-white');
            }
        }
        
        // Admin Section Functions
        function showJobsSection() {
            document.getElementById('dashboardContent').innerHTML = `
                <div class="dashboard-card rounded-xl p-8 animate-fadeInUp">
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center space-x-3">
                            <div class="w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center text-white text-xl">
                                <i class="fas fa-briefcase"></i>
                            </div>
                            <h2 class="text-2xl font-bold text-gray-800">Job Management</h2>
                        </div>
                        <button onclick="showAdminDashboard()" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition duration-300">
                            <i class="fas fa-arrow-left mr-2"></i>Back to Dashboard
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-6 rounded-lg border border-blue-200">
                            <h3 class="text-lg font-semibold text-blue-800 mb-3">
                                <i class="fas fa-plus-circle mr-2"></i>Post New Job
                            </h3>
                            <p class="text-gray-600 mb-4">Create and publish new job opportunities</p>
                            <button onclick="showAdminJobsSection()" class="w-full bg-blue-500 text-white px-4 py-2 rounded-lg font-semibold hover:shadow-lg transition duration-300">
                                <i class="fas fa-plus mr-2"></i>Post Job
                            </button>
                        </div>
                        
                        <div class="bg-green-50 p-6 rounded-lg border border-green-200">
                            <h3 class="text-lg font-semibold text-green-800 mb-3">
                                <i class="fas fa-list mr-2"></i>Manage Jobs
                            </h3>
                            <p class="text-gray-600 mb-4">View and edit existing job postings</p>
                            <button onclick="showAdminJobsSection()" class="w-full bg-green-500 text-white px-4 py-2 rounded-lg font-semibold hover:shadow-lg transition duration-300">
                                <i class="fas fa-edit mr-2"></i>Manage Jobs
                            </button>
                        </div>
                        
                        <div class="bg-purple-50 p-6 rounded-lg border border-purple-200">
                            <h3 class="text-lg font-semibold text-purple-800 mb-3">
                                <i class="fas fa-chart-bar mr-2"></i>Job Analytics
                            </h3>
                            <p class="text-gray-600 mb-4">View job posting statistics and insights</p>
                            <button class="w-full bg-purple-500 text-white px-4 py-2 rounded-lg font-semibold hover:shadow-lg transition duration-300">
                                <i class="fas fa-chart-line mr-2"></i>View Analytics
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function showUsersSection() {
            document.getElementById('dashboardContent').innerHTML = `
                <div class="dashboard-card rounded-xl p-8 animate-fadeInUp">
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center space-x-3">
                            <div class="w-12 h-12 bg-green-500 rounded-full flex items-center justify-center text-white text-xl">
                                <i class="fas fa-users"></i>
                            </div>
                            <h2 class="text-2xl font-bold text-gray-800">User Management</h2>
                        </div>
                        <button onclick="showAdminDashboard()" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition duration-300">
                            <i class="fas fa-arrow-left mr-2"></i>Back to Dashboard
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-6 rounded-lg border border-blue-200">
                            <h3 class="text-lg font-semibold text-blue-800 mb-3">
                                <i class="fas fa-user-plus mr-2"></i>Add User
                            </h3>
                            <p class="text-gray-600 mb-4">Create new user accounts</p>
                            <button onclick="showUserManagement()" class="w-full bg-blue-500 text-white px-4 py-2 rounded-lg font-semibold hover:shadow-lg transition duration-300">
                                <i class="fas fa-plus mr-2"></i>Add User
                            </button>
                        </div>
                        
                        <div class="bg-green-50 p-6 rounded-lg border border-green-200">
                            <h3 class="text-lg font-semibold text-green-800 mb-3">
                                <i class="fas fa-users-cog mr-2"></i>Manage Users
                            </h3>
                            <p class="text-gray-600 mb-4">View and edit user accounts</p>
                            <button onclick="showUserManagement()" class="w-full bg-green-500 text-white px-4 py-2 rounded-lg font-semibold hover:shadow-lg transition duration-300">
                                <i class="fas fa-edit mr-2"></i>Manage Users
                            </button>
                        </div>
                        
                        <div class="bg-purple-50 p-6 rounded-lg border border-purple-200">
                            <h3 class="text-lg font-semibold text-purple-800 mb-3">
                                <i class="fas fa-shield-alt mr-2"></i>Permissions
                            </h3>
                            <p class="text-gray-600 mb-4">Manage user roles and permissions</p>
                            <button class="w-full bg-purple-500 text-white px-4 py-2 rounded-lg font-semibold hover:shadow-lg transition duration-300">
                                <i class="fas fa-key mr-2"></i>Manage Permissions
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }
        
        async function showAnalyticsSection() {
            document.getElementById('dashboardContent').innerHTML = `
                <div class="dashboard-card rounded-xl p-8 animate-fadeInUp">
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center space-x-3">
                            <div class="w-12 h-12 bg-purple-500 rounded-full flex items-center justify-center text-white text-xl">
                                <i class="fas fa-chart-bar"></i>
                            </div>
                            <h2 class="text-2xl font-bold text-gray-800">Analytics Dashboard</h2>
                        </div>
                        <button onclick="showAdminDashboard()" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition duration-300">
                            <i class="fas fa-arrow-left mr-2"></i>Back to Dashboard
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                        <div class="stats-card rounded-lg p-6 text-center">
                            <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-users text-blue-600 text-xl"></i>
                            </div>
                            <div class="text-3xl font-bold mb-2" id="totalUsers">-</div>
                            <div class="text-sm opacity-90">Total Users</div>
                        </div>
                        <div class="stats-card rounded-lg p-6 text-center">
                            <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-briefcase text-green-600 text-xl"></i>
                            </div>
                            <div class="text-3xl font-bold mb-2" id="totalJobs">-</div>
                            <div class="text-sm opacity-90">Total Jobs</div>
                        </div>
                        <div class="stats-card rounded-lg p-6 text-center">
                            <div class="w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-file-alt text-orange-600 text-xl"></i>
                            </div>
                            <div class="text-3xl font-bold mb-2" id="totalApplications">-</div>
                            <div class="text-sm opacity-90">Total Applications</div>
                        </div>
                        <div class="stats-card rounded-lg p-6 text-center">
                            <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-file-pdf text-purple-600 text-xl"></i>
                            </div>
                            <div class="text-3xl font-bold mb-2" id="totalResumes">-</div>
                            <div class="text-sm opacity-90">Total Resumes</div>
                        </div>
                        <div class="stats-card rounded-lg p-6 text-center">
                            <div class="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-chart-line text-red-600 text-xl"></i>
                            </div>
                            <div class="text-3xl font-bold mb-2" id="activeJobs">-</div>
                            <div class="text-sm opacity-90">Active Jobs</div>
                        </div>
                        <div class="stats-card rounded-lg p-6 text-center">
                            <div class="w-12 h-12 bg-indigo-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-percentage text-indigo-600 text-xl"></i>
                            </div>
                            <div class="text-3xl font-bold mb-2" id="applicationRate">-</div>
                            <div class="text-sm opacity-90">Application Rate</div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-6 rounded-lg border border-blue-200">
                            <h3 class="text-lg font-semibold text-blue-800 mb-4">
                                <i class="fas fa-chart-line mr-2"></i>Application Status Breakdown
                            </h3>
                            <div id="applicationStatusChart" class="space-y-3">
                                <div class="flex justify-between items-center">
                                    <span class="text-sm text-gray-600">Applied</span>
                                    <span class="text-sm font-semibold" id="statusApplied">-</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm text-gray-600">Under Review</span>
                                    <span class="text-sm font-semibold" id="statusUnderReview">-</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm text-gray-600">Accepted</span>
                                    <span class="text-sm font-semibold" id="statusAccepted">-</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm text-gray-600">Rejected</span>
                                    <span class="text-sm font-semibold" id="statusRejected">-</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm text-gray-600">Interview Scheduled</span>
                                    <span class="text-sm font-semibold" id="statusInterview">-</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-green-50 p-6 rounded-lg border border-green-200">
                            <h3 class="text-lg font-semibold text-green-800 mb-4">
                                <i class="fas fa-chart-pie mr-2"></i>User Role Distribution
                            </h3>
                            <div id="userRoleChart" class="space-y-3">
                                <div class="flex justify-between items-center">
                                    <span class="text-sm text-gray-600">Candidates</span>
                                    <span class="text-sm font-semibold" id="roleCandidates">-</span>
                            </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm text-gray-600">Admins</span>
                                    <span class="text-sm font-semibold" id="roleAdmins">-</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm text-gray-600">Users with Resumes</span>
                                    <span class="text-sm font-semibold" id="usersWithResumes">-</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
        }
        
        // Candidate Section Functions
        function showJobsSection() {
            hideAllSections();
            document.getElementById('dashboard-jobs').classList.remove('hidden');
            updateNavigation('nav-jobs');
            
            document.getElementById('dashboard-jobs').innerHTML = `
                <div class="dashboard-card rounded-xl p-8 animate-fadeInUp">
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center space-x-3">
                            <div class="w-12 h-12 bg-purple-500 rounded-full flex items-center justify-center text-white text-xl">
                                <i class="fas fa-search"></i>
                            </div>
                            <h2 class="text-2xl font-bold text-gray-800">Browse Jobs</h2>
                        </div>
                        <button onclick="showCandidateDashboard()" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition duration-300">
                            <i class="fas fa-arrow-left mr-2"></i>Back to Dashboard
                        </button>
                    </div>
                    
                    <!-- Search and Filter Section -->
                    <div class="bg-purple-50 p-6 rounded-lg border border-purple-200 mb-6">
                        <h3 class="text-lg font-semibold text-purple-800 mb-4">Search & Filter Jobs</h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Search Keywords</label>
                                <input type="text" id="jobSearch" placeholder="Job title, skills, company..." 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Location</label>
                                <input type="text" id="jobLocation" placeholder="City, State, Country..." 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Company</label>
                                <input type="text" id="jobCompany" placeholder="Company name..." 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Min Salary</label>
                                <input type="number" id="minSalary" placeholder="50000" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Max Salary</label>
                                <input type="number" id="maxSalary" placeholder="100000" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Job Type</label>
                                <select id="jobType" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
                                    <option value="">All Types</option>
                                    <option value="full-time">Full Time</option>
                                    <option value="part-time">Part Time</option>
                                    <option value="contract">Contract</option>
                                    <option value="internship">Internship</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="flex justify-between items-center">
                            <button onclick="searchJobs()" class="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 transition duration-300">
                                <i class="fas fa-search mr-2"></i>Search Jobs
                            </button>
                            <button onclick="clearFilters()" class="bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 transition duration-300">
                                <i class="fas fa-times mr-2"></i>Clear Filters
                            </button>
                        </div>
                    </div>
                    
                    <!-- Job Listings -->
                    <div class="space-y-4" id="jobsList">
                        <!-- Jobs will be loaded dynamically from the database -->
                        <div class="text-center text-gray-500 py-8">
                            <i class="fas fa-briefcase text-4xl mb-4"></i>
                            <p>No jobs available at the moment.</p>
                            <p class="text-sm">Jobs will be posted by authorized users.</p>
                        </div>
                    </div>
                    </div>
                </div>
            `;
        }
        
        function showMyApplicationsSection() {
            hideAllSections();
            document.getElementById('dashboard-applications').classList.remove('hidden');
            updateNavigation('nav-applications');
            
            document.getElementById('dashboard-applications').innerHTML = `
                <div class="dashboard-card rounded-xl p-8 animate-fadeInUp">
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center space-x-3">
                            <div class="w-12 h-12 bg-purple-500 rounded-full flex items-center justify-center text-white text-xl">
                                <i class="fas fa-file-alt"></i>
                            </div>
                            <h2 class="text-2xl font-bold text-gray-800">My Applications</h2>
                        </div>
                        <button onclick="showCandidateDashboard()" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition duration-300">
                            <i class="fas fa-arrow-left mr-2"></i>Back to Dashboard
                        </button>
                    </div>
                    
                    <!-- Application Status Overview -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-4 rounded-lg border border-blue-200 text-center">
                            <div class="text-2xl font-bold text-blue-600">0</div>
                            <div class="text-sm text-gray-600">Total Applications</div>
                        </div>
                        <div class="bg-gradient-to-r from-green-50 to-emerald-50 p-4 rounded-lg border border-green-200 text-center">
                            <div class="text-2xl font-bold text-green-600">0</div>
                            <div class="text-sm text-gray-600">Accepted</div>
                        </div>
                        <div class="bg-gradient-to-r from-red-50 to-pink-50 p-4 rounded-lg border border-red-200 text-center">
                            <div class="text-2xl font-bold text-red-600">0</div>
                            <div class="text-sm text-gray-600">Rejected</div>
                        </div>
                    </div>
                    
                    <!-- Application List -->
                    <div class="space-y-4" id="applicationsList">
                        <!-- Applications will be loaded dynamically from the database -->
                        <div class="text-center text-gray-500 py-8">
                            <i class="fas fa-file-alt text-4xl mb-4"></i>
                            <p>No applications yet.</p>
                            <p class="text-sm">Apply to jobs to see your applications here.</p>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // Load user role from user data
         async function loadUserRole(retryCount = 0) {
             try {
                 const token = localStorage.getItem('token');
                 const userRoleElement = document.getElementById('userRole');
                 
                 if (!token) {
                     if (userRoleElement) {
                         userRoleElement.textContent = 'Not logged in';
                     }
                     return;
                 }
                 
                 if (!userRoleElement) {
                     // Element not found, retry after a short delay
                     if (retryCount < 3) {
                         setTimeout(() => loadUserRole(retryCount + 1), 500);
                     }
                     return;
                 }
                 
                 const response = await fetch('http://localhost:8005/api/user-resume', {
                     headers: {
                         'Authorization': `Bearer ${token}`
                     }
                 });
                 
                 if (response.ok) {
                     const data = await response.json();
                     const role = data.role || 'No Resume Uploaded';
                     userRoleElement.textContent = role;
                     console.log('✅ User role loaded:', role);
                 } else {
                     userRoleElement.textContent = 'User';
                 }
             } catch (error) {
                 console.error('Error loading user role:', error);
                 const userRoleElement = document.getElementById('userRole');
                 if (userRoleElement) {
                     userRoleElement.textContent = 'Error loading role';
                 }
                 
                 // Retry once more if this was the first attempt
                 if (retryCount === 0) {
                     setTimeout(() => loadUserRole(1), 1000);
                 }
             }
         }
         
        
        // Show Candidate Dashboard
        function showCandidateDashboard(userName, user) {
            document.getElementById('dashboardContainer').innerHTML = `
                <div class="min-h-screen" style="background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);">
                    <!-- Professional Candidate Header -->
                    <div class="candidate-header text-white">
                        <div class="max-w-7xl mx-auto px-6 py-8 relative z-10">
                            <div class="flex justify-between items-center">
                                <div class="animate-slideInLeft">
                                    <div class="flex items-center gap-4 mb-2">
                                        <div class="w-14 h-14 bg-white/20 backdrop-blur-md rounded-2xl flex items-center justify-center shadow-xl">
                                            <i class="fas fa-user-circle text-3xl"></i>
                                        </div>
                                        <div>
                                            <h1 class="text-4xl font-black tracking-tight">Candidate Dashboard</h1>
                                            <p class="text-purple-100 mt-1 text-sm font-medium">Welcome back, ${userName}</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-4 animate-slideInRight">
                                    <div class="candidate-application-badge bg-white/20 backdrop-blur-md border-white/30 text-white shadow-xl">
                                        <i class="fas fa-user mr-2"></i>
                                        <span class="font-bold">${userName}</span>
                                    </div>
                                    <button onclick="logout()" class="btn-professional btn-professional-danger">
                                        <i class="fas fa-sign-out-alt mr-2"></i>Logout
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    
                    <!-- Dashboard Content -->
                    <div class="max-w-7xl mx-auto py-8 px-4">
                        <!-- Cards Side by Side Layout -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 mb-8">
                            <!-- Professional Profile Card -->
                            <div class="candidate-profile-card animate-fadeInUp">
                                <div class="flex items-center gap-4 mb-6">
                                    <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl flex items-center justify-center text-white shadow-xl">
                                        <i class="fas fa-user text-2xl"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-xl font-bold text-gray-800">My Profile</h3>
                                        <p class="text-sm text-green-600 font-semibold flex items-center gap-2">
                                            <i class="fas fa-check-circle"></i>Active
                                        </p>
                                    </div>
                                </div>
                                <div class="space-y-3 mb-6 bg-gray-50 rounded-xl p-4">
                                    <div class="flex items-center gap-3">
                                        <i class="fas fa-user text-blue-500"></i>
                                        <span class="text-gray-700 font-medium">${userName}</span>
                                    </div>
                                    <div class="flex items-center gap-3">
                                        <i class="fas fa-envelope text-blue-500"></i>
                                        <span class="text-gray-700 text-sm">${user.email || 'Not provided'}</span>
                                    </div>
                                    <div class="flex items-center gap-3">
                                        <i class="fas fa-briefcase text-blue-500"></i>
                                        <span id="userRole" class="text-blue-600 font-semibold">Loading...</span>
                                    </div>
                                </div>
                                <div class="space-y-3">
                                    <button onclick="handleViewProfile()" class="btn-professional btn-professional-primary w-full">
                                        <i class="fas fa-eye mr-2"></i>View Profile
                                    </button>
                                    <button onclick="forceRefreshData()" class="btn-professional btn-professional-success w-full">
                                        <i class="fas fa-sync-alt mr-2"></i>Refresh Data
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Professional Browse Jobs Card -->
                            <div class="candidate-job-card animate-fadeInUp" style="animation-delay: 0.1s;">
                                <div class="flex items-center gap-4 mb-5">
                                    <div class="w-16 h-16 bg-gradient-to-br from-purple-500 to-purple-600 rounded-2xl flex items-center justify-center text-white shadow-xl">
                                        <i class="fas fa-search text-2xl"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-xl font-bold text-gray-800">Browse Jobs</h3>
                                        <p class="text-sm text-gray-500">Find opportunities</p>
                                    </div>
                                </div>
                                <p class="text-gray-600 mb-6 leading-relaxed">Discover amazing career opportunities perfectly matched to your skills and experience</p>
                                <button onclick="showJobsContent()" class="btn-professional btn-professional-purple w-full">
                                    <i class="fas fa-search mr-2"></i>Browse Jobs
                                </button>
                            </div>
                            
                            <!-- Professional My Applications Card -->
                            <div class="candidate-job-card animate-fadeInUp" style="animation-delay: 0.2s;">
                                <div class="flex items-center gap-4 mb-5">
                                    <div class="w-16 h-16 bg-gradient-to-br from-indigo-500 to-indigo-600 rounded-2xl flex items-center justify-center text-white shadow-xl">
                                        <i class="fas fa-file-alt text-2xl"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-xl font-bold text-gray-800">My Applications</h3>
                                        <p class="text-sm text-gray-500">Track progress</p>
                                    </div>
                                </div>
                                <p class="text-gray-600 mb-6 leading-relaxed">Monitor and manage all your job applications in one centralized location</p>
                                <button onclick="showApplicationsContent()" class="btn-professional btn-professional-purple w-full">
                                    <i class="fas fa-file-alt mr-2"></i>View Applications
                                </button>
                            </div>
                            
                            <!-- Professional AI Analysis Card -->
                            <div class="candidate-job-card animate-fadeInUp" style="animation-delay: 0.3s;">
                                <div class="flex items-center gap-4 mb-5">
                                    <div class="w-16 h-16 bg-gradient-to-br from-slate-700 via-slate-800 to-slate-900 rounded-2xl flex items-center justify-center text-white shadow-xl border-2 border-cyan-400">
                                        <i class="fas fa-robot text-2xl" style="color: #06b6d4 !important;"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-xl font-bold text-gray-800">AI Analysis</h3>
                                        <p class="text-sm text-gray-500">Career insights</p>
                                    </div>
                                </div>
                                <p class="text-gray-600 mb-6 leading-relaxed">Get advanced AI-powered career insights and personalized recommendations</p>
                                <button onclick="showAIAnalysisContent()" class="btn-professional btn-professional-primary w-full">
                                    <i class="fas fa-robot mr-2"></i>AI Career Analysis
                                </button>
                            </div>
                            
                            <!-- Professional Upload Resume Card -->
                            <div class="candidate-job-card animate-fadeInUp" style="animation-delay: 0.4s;">
                                <div class="flex items-center gap-4 mb-5">
                                    <div class="w-16 h-16 bg-gradient-to-br from-slate-700 via-slate-800 to-slate-900 rounded-2xl flex items-center justify-center text-white shadow-xl border-2 border-emerald-400">
                                        <i class="fas fa-file-upload text-2xl" style="color: #10b981 !important;"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-xl font-bold text-gray-800">Upload Resume</h3>
                                        <p class="text-sm text-gray-500">Update your CV</p>
                                    </div>
                                </div>
                                <p class="text-gray-600 mb-6 leading-relaxed">Upload your resume to get AI-powered analysis and personalized job recommendations</p>
                                
                                <!-- Resume Status Display -->
                                <div id="resumeStatus" class="mb-3">
                                    <div class="bg-gray-100 border border-gray-300 rounded-lg p-3">
                                        <div class="flex items-center">
                                            <i class="fas fa-file-upload text-gray-500 mr-2 text-sm"></i>
                                            <span class="text-gray-700 text-sm font-medium">No resume uploaded yet</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Extracted Resume Data Display -->
                                <div id="extractedResumeData" class="mb-3 hidden">
                                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-3">
                                        <h4 class="text-sm font-semibold text-blue-800 mb-2">
                                            <i class="fas fa-robot mr-2"></i>ML-Powered Resume Analysis
                                        </h4>
                                        <div class="grid grid-cols-1 gap-2 text-xs">
                                            <div>
                                                <strong class="text-blue-700">Name:</strong>
                                                <span id="extractedName" class="text-gray-700">-</span>
                                            </div>
                                            <div>
                                                <strong class="text-blue-700">Role:</strong>
                                                <span id="extractedRole" class="text-gray-700">-</span>
                                            </div>
                                            <div>
                                                <strong class="text-blue-700">Email:</strong>
                                                <span id="extractedEmail" class="text-gray-700">-</span>
                                            </div>
                                            <div>
                                                <strong class="text-blue-700">Phone:</strong>
                                                <span id="extractedPhone" class="text-gray-700">-</span>
                                            </div>
                                            <div>
                                                <strong class="text-blue-700">Experience:</strong>
                                                <span id="extractedExperience" class="text-gray-700">-</span>
                                            </div>
                                            <div>
                                                <strong class="text-blue-700">Location:</strong>
                                                <span id="extractedLocation" class="text-gray-700">-</span>
                                            </div>
                                            <div>
                                                <strong class="text-blue-700">Skills Count:</strong>
                                                <span id="extractedSkillsCount" class="text-gray-700">-</span>
                                            </div>
                                        </div>
                                        <div class="mt-2">
                                            <strong class="text-blue-700">Skills:</strong>
                                            <div id="extractedSkills" class="text-gray-700 mt-1 text-xs"></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Upload Button -->
                                <div id="uploadButtonContainer" class="text-center" style="display: block !important; visibility: visible !important; opacity: 1 !important;">
                                    <div class="space-y-3">
                                        <button onclick="document.getElementById('resumeFileDashboard').click()" class="btn-professional btn-professional-success w-full">
                                            <i class="fas fa-upload mr-2"></i>Upload Resume
                                        </button>
                                        <input type="file" id="resumeFileDashboard" accept=".pdf" style="display: none;" onchange="uploadResumeFile(event)">
                                        <button onclick="removeResume()" class="btn-professional btn-professional-danger w-full">
                                            <i class="fas fa-trash mr-2"></i>Remove Resume
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                        </div>
                        
                        <!-- Content Area -->
                        <div class="mt-8">
                            <div id="rightContent" class="bg-white rounded-xl shadow-lg p-8 min-h-[600px] border-2 border-gray-200">
                                <div class="text-center py-20">
                                    <i class="fas fa-mouse-pointer text-6xl mb-6" style="color: #667eea;"></i>
                                    <h3 class="text-2xl font-bold mb-3" style="color: #1e293b;">Select a Card</h3>
                                    <p class="text-lg" style="color: #475569;">Click on any card above to view its content here</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                </div>
            `;
        }
        
        // Content display functions for right column
        async function handleViewProfile() {
            await showProfileContent();
        }
        
        async function showProfileContent() {
            document.getElementById('rightContent').innerHTML = `
                <div class="animate-fadeInUp">
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center space-x-3">
                            <div class="w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center text-white text-xl">
                                <i class="fas fa-user"></i>
                            </div>
                            <h2 class="text-2xl font-bold" style="color: #1e293b;">My Profile</h2>
                        </div>
                    </div>
                    
                    <div class="bg-blue-50 p-6 rounded-lg border border-blue-200">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-blue-800">Profile Information</h3>
                            <button onclick="showEditProfileForm()" class="bg-blue-500 text-white px-4 py-2 rounded-lg font-semibold shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105 hover:bg-blue-600">
                                <i class="fas fa-edit mr-2"></i>Edit Profile
                            </button>
                        </div>
                        <div class="space-y-3">
                            <div class="flex items-center space-x-3">
                                <i class="fas fa-user text-gray-400"></i>
                                <span class="text-gray-700"><strong>Name:</strong> <span id="profileNameRight">Loading...</span></span>
                            </div>
                            <div class="flex items-center space-x-3">
                                <i class="fas fa-envelope text-gray-400"></i>
                                <span class="text-gray-700"><strong>Email:</strong> <span id="profileEmailRight">Loading...</span></span>
                            </div>
                            <div class="flex items-center space-x-3">
                                <i class="fas fa-briefcase text-gray-400"></i>
                                <span class="text-gray-700"><strong>Role:</strong> <span id="profileRoleRight">Loading...</span></span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            await loadProfileRoleRight();
        }
        
        function showJobsContent() {
            document.getElementById('rightContent').innerHTML = `
                <div class="animate-fadeInUp">
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center space-x-3">
                            <div class="w-12 h-12 bg-purple-500 rounded-full flex items-center justify-center text-white text-xl">
                                <i class="fas fa-search"></i>
                            </div>
                            <h2 class="text-2xl font-bold" style="color: #1e293b;">Browse Jobs</h2>
                        </div>
                    </div>
                    
                    <!-- Search and Filter Section -->
                    <div class="bg-purple-50 p-6 rounded-lg border border-purple-200 mb-6">
                        <h3 class="text-lg font-semibold text-purple-800 mb-4">Search & Filter Jobs</h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Search Keywords</label>
                                <input type="text" id="rightJobSearch" placeholder="Job title, skills, company..." 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Location</label>
                                <input type="text" id="rightJobLocation" placeholder="City, State, Country..." 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Company</label>
                                <input type="text" id="rightJobCompany" placeholder="Company name..." 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Min Salary</label>
                                <input type="number" id="rightMinSalary" placeholder="50000" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Max Salary</label>
                                <input type="number" id="rightMaxSalary" placeholder="100000" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Job Type</label>
                                <select id="rightJobType" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
                                    <option value="">All Types</option>
                                    <option value="full-time">Full Time</option>
                                    <option value="part-time">Part Time</option>
                                    <option value="contract">Contract</option>
                                    <option value="internship">Internship</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="flex justify-between items-center">
                            <button onclick="searchJobsRight()" class="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 transition duration-300">
                                <i class="fas fa-search mr-2"></i>Search Jobs
                            </button>
                            <button onclick="clearFiltersRight()" class="bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 transition duration-300">
                                <i class="fas fa-times mr-2"></i>Clear Filters
                            </button>
                        </div>
                    </div>
                    
                    <div class="space-y-4" id="rightJobsList">
                        <!-- Jobs will be loaded dynamically from the database -->
                        <div class="text-center text-gray-500 py-8">
                            <i class="fas fa-briefcase text-4xl mb-4"></i>
                            <p>No jobs available at the moment.</p>
                            <p class="text-sm">Jobs will be posted by authorized users.</p>
                        </div>
                    </div>
                </div>
            `;
            loadJobsRight();
        }
        
        function showApplicationsContent() {
            document.getElementById('rightContent').innerHTML = `
                <div class="animate-fadeInUp">
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center space-x-3">
                            <div class="w-12 h-12 bg-purple-500 rounded-full flex items-center justify-center text-white text-xl">
                                <i class="fas fa-file-alt"></i>
                            </div>
                            <h2 class="text-2xl font-bold" style="color: #1e293b;">My Applications</h2>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-4 rounded-lg border border-blue-200 text-center">
                            <div class="text-2xl font-bold text-blue-600">0</div>
                            <div class="text-sm text-gray-600">Total Applications</div>
                        </div>
                        <div class="bg-gradient-to-r from-green-50 to-emerald-50 p-4 rounded-lg border border-green-200 text-center">
                            <div class="text-2xl font-bold text-green-600">0</div>
                            <div class="text-sm text-gray-600">Accepted</div>
                        </div>
                        <div class="bg-gradient-to-r from-red-50 to-pink-50 p-4 rounded-lg border border-red-200 text-center">
                            <div class="text-2xl font-bold text-red-600">0</div>
                            <div class="text-sm text-gray-600">Rejected</div>
                        </div>
                    </div>
                    
                    <div class="space-y-4" id="rightApplicationsList">
                        <!-- Applications will be loaded dynamically from the database -->
                        <div class="text-center text-gray-500 py-8">
                            <i class="fas fa-file-alt text-4xl mb-4"></i>
                            <p>No applications yet.</p>
                            <p class="text-sm">Apply to jobs to see your applications here.</p>
                        </div>
                    </div>
                </div>
            `;
            
            // Load applications after content is shown
            setTimeout(() => {
                loadMyApplications();
            }, 100);
        }
        
        function showAIAnalysisContent() {
            document.getElementById('rightContent').innerHTML = `
                <div class="animate-fadeInUp">
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center space-x-3">
                            <div class="w-12 h-12 bg-indigo-500 rounded-full flex items-center justify-center text-white text-xl">
                                <i class="fas fa-robot"></i>
                            </div>
                            <h2 class="text-2xl font-bold" style="color: #1e293b;">AI Analysis</h2>
                        </div>
                    </div>
                    
                    <div class="bg-indigo-50 p-6 rounded-lg border border-indigo-200 mb-6">
                        <h3 class="text-lg font-semibold text-indigo-800 mb-3">Advanced AI-powered career insights and recommendations</h3>
                        <div class="space-y-3">
                            <button onclick="runMLAnalysis()" class="w-full bg-indigo-500 text-white px-6 py-3 rounded-lg font-semibold shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105">
                                <i class="fas fa-robot mr-2"></i>AI Career Analysis
                            </button>
                        </div>
                    </div>
                    
                    <div id="aiAnalysisResults" class="hidden">
                        <!-- AI Analysis results will be displayed here -->
                    </div>
                </div>
            `;
        }
        
        async function loadProfileData() {
            const token = localStorage.getItem('token');
            if (!token) return;
            
            try {
                // Always fetch fresh data from API instead of using localStorage
                const response = await fetch('http://localhost:8005/api/user-resume', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                // Update profile elements
                const nameElement = document.getElementById('profileName');
                const emailElement = document.getElementById('profileEmail');
                const roleElement = document.getElementById('profileRole');
                
                if (response.ok) {
                    const data = await response.json();
                    
                    // Update all profile elements with fresh data
                    if (nameElement) {
                        nameElement.textContent = data.name || 'Not provided';
                    }
                    if (emailElement) {
                        emailElement.textContent = data.email || 'Not provided';
                    }
                    if (roleElement) {
                        roleElement.textContent = data.role || 'No Resume Uploaded';
                    }
                    
                    // Update localStorage with fresh data
                    const userStr = localStorage.getItem('user');
                    const user = userStr && userStr !== 'null' && userStr !== 'undefined' ? JSON.parse(userStr) : {};
                    user.name = data.name;
                    user.email = data.email;
                    localStorage.setItem('user', JSON.stringify(user));
                    
                } else {
                    // Fallback to localStorage if API fails
                    const userStr = localStorage.getItem('user');
                    const user = userStr && userStr !== 'null' && userStr !== 'undefined' ? JSON.parse(userStr) : {};
                    
                    if (nameElement) {
                        nameElement.textContent = user.name || 'Not provided';
                    }
                    if (emailElement) {
                        emailElement.textContent = user.email || 'Not provided';
                    }
                    if (roleElement) {
                        roleElement.textContent = 'No Resume Uploaded';
                    }
                }
            } catch (error) {
                console.error('Error loading profile data:', error);
                const nameElement = document.getElementById('profileName');
                const emailElement = document.getElementById('profileEmail');
                const roleElement = document.getElementById('profileRole');
                
                if (nameElement) {
                    nameElement.textContent = 'Error loading name';
                }
                if (emailElement) {
                    emailElement.textContent = 'Error loading email';
                }
                if (roleElement) {
                    roleElement.textContent = 'Error loading role';
                }
            }
        }

        async function loadProfileRoleRight() {
            const token = localStorage.getItem('token');
            if (!token) return;
            
            try {
                // Load user data from localStorage first
                const userStr = localStorage.getItem('user');
                const user = userStr && userStr !== 'null' && userStr !== 'undefined' ? JSON.parse(userStr) : {};
                
                // Update profile elements
                const nameElement = document.getElementById('profileNameRight');
                const emailElement = document.getElementById('profileEmailRight');
                const roleElement = document.getElementById('profileRoleRight');
                
                if (nameElement) {
                    nameElement.textContent = user.name || 'Not provided';
                }
                if (emailElement) {
                    emailElement.textContent = user.email || 'Not provided';
                }
                
                // Load role from API
                if (roleElement) {
                    const response = await fetch('http://localhost:8005/api/user-resume', {
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        roleElement.textContent = data.role || 'No Resume Uploaded';
                    } else {
                        roleElement.textContent = 'No Resume Uploaded';
                    }
                }
            } catch (error) {
                console.error('Error loading profile role right:', error);
                const roleElement = document.getElementById('profileRoleRight');
                if (roleElement) {
                    roleElement.textContent = 'Error loading role';
                }
            }
        }

        async function loadProfileCard() {
            const token = localStorage.getItem('token');
            if (!token) return;
            
            try {
                // Always fetch fresh data from API instead of using localStorage
                const response = await fetch('http://localhost:8005/api/user-resume', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                // Update profile card elements
                const nameElement = document.getElementById('profileNameCard');
                const emailElement = document.getElementById('profileEmailCard');
                const roleElement = document.getElementById('profileRoleCard');
                
                if (response.ok) {
                    const data = await response.json();
                    
                    // Update all profile card elements with fresh data
                    if (nameElement) {
                        nameElement.textContent = data.name || 'Not provided';
                    }
                    if (emailElement) {
                        emailElement.textContent = data.email || 'Not provided';
                    }
                    if (roleElement) {
                        roleElement.textContent = data.role || 'No Resume Uploaded';
                    }
                    
                    // Update localStorage with fresh data
                    const userStr = localStorage.getItem('user');
                    const user = userStr && userStr !== 'null' && userStr !== 'undefined' ? JSON.parse(userStr) : {};
                    user.name = data.name;
                    user.email = data.email;
                    localStorage.setItem('user', JSON.stringify(user));
                    
                } else {
                    // Fallback to localStorage if API fails
                    const userStr = localStorage.getItem('user');
                    const user = userStr && userStr !== 'null' && userStr !== 'undefined' ? JSON.parse(userStr) : {};
                    
                    if (nameElement) {
                        nameElement.textContent = user.name || 'Not provided';
                    }
                    if (emailElement) {
                        emailElement.textContent = user.email || 'Not provided';
                    }
                    if (roleElement) {
                        roleElement.textContent = 'No Resume Uploaded';
                    }
                }
            } catch (error) {
                console.error('Error loading profile card:', error);
                const nameElement = document.getElementById('profileNameCard');
                const emailElement = document.getElementById('profileEmailCard');
                const roleElement = document.getElementById('profileRoleCard');
                
                if (nameElement) {
                    nameElement.textContent = 'Error loading name';
                }
                if (emailElement) {
                    emailElement.textContent = 'Error loading email';
                }
                if (roleElement) {
                    roleElement.textContent = 'Error loading role';
                }
            }
        }

        function showEditProfileForm() {
            const userStr = localStorage.getItem('user');
            const user = userStr && userStr !== 'null' && userStr !== 'undefined' ? JSON.parse(userStr) : {};
            
            document.getElementById('rightContent').innerHTML = `
                <div class="animate-fadeInUp">
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center space-x-3">
                            <div class="w-12 h-12 bg-green-500 rounded-full flex items-center justify-center text-white text-xl">
                                <i class="fas fa-edit"></i>
                            </div>
                            <h2 class="text-2xl font-bold" style="color: #1e293b;">Edit Profile</h2>
                        </div>
                        <button onclick="handleViewProfile()" class="bg-gray-500 text-white px-4 py-2 rounded-lg font-semibold shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105 hover:bg-gray-600">
                            <i class="fas fa-arrow-left mr-2"></i>Back to Profile
                        </button>
                    </div>
                    
                    <div class="bg-white p-6 rounded-lg border border-gray-200 shadow-lg">
                        <form id="editProfileForm" onsubmit="updateProfile(event)">
                            <div class="space-y-4">
                                <div>
                                    <label for="editName" class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-user mr-2"></i>Full Name
                                    </label>
                                    <input type="text" id="editName" name="name" value="${user.name || ''}" 
                                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-300" 
                                           placeholder="Enter your full name" required>
                                </div>
                                
                                <div>
                                    <label for="editEmail" class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-envelope mr-2"></i>Email Address
                                    </label>
                                    <input type="email" id="editEmail" name="email" value="${user.email || ''}" 
                                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-300" 
                                           placeholder="Enter your email address" required readonly>
                                    <p class="text-xs text-gray-500 mt-1">Email cannot be changed</p>
                                </div>
                                
                                <div>
                                    <label for="editPhone" class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-phone mr-2"></i>Phone Number
                                    </label>
                                    <input type="tel" id="editPhone" name="phone" value="${user.phone || ''}" 
                                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-300" 
                                           placeholder="Enter your phone number">
                                </div>
                                
                                <div>
                                    <label for="editLocation" class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-map-marker-alt mr-2"></i>Location
                                    </label>
                                    <input type="text" id="editLocation" name="location" value="${user.location || ''}" 
                                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-300" 
                                           placeholder="Enter your location">
                                </div>
                            </div>
                            
                            <div class="flex space-x-4 mt-6">
                                <button type="submit" class="flex-1 bg-green-500 text-white px-6 py-3 rounded-lg font-semibold shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105 hover:bg-green-600">
                                    <i class="fas fa-save mr-2"></i>Save Changes
                                </button>
                                <button type="button" onclick="handleViewProfile()" class="flex-1 bg-gray-500 text-white px-6 py-3 rounded-lg font-semibold shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105 hover:bg-gray-600">
                                    <i class="fas fa-times mr-2"></i>Cancel
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
        }

        async function updateProfile(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const profileData = {
                name: formData.get('name'),
                phone: formData.get('phone'),
                location: formData.get('location')
            };
            
            const token = localStorage.getItem('token');
            if (!token) {
                alert('Please login first');
                return;
            }
            
            try {
                const response = await fetch('http://localhost:8005/api/update-profile', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(profileData)
                });
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('✅ Profile updated successfully:', data);
                    
                    // Update localStorage
                    const userStr = localStorage.getItem('user');
                    const user = userStr && userStr !== 'null' && userStr !== 'undefined' ? JSON.parse(userStr) : {};
                    user.name = profileData.name;
                    user.phone = profileData.phone;
                    user.location = profileData.location;
                    localStorage.setItem('user', JSON.stringify(user));
                    
                    alert('Profile updated successfully!');
                    await showProfileContent();
                } else {
                    const errorData = await response.json();
                    alert('Error updating profile: ' + errorData.detail);
                }
            } catch (error) {
                console.error('Error updating profile:', error);
                alert('Network error. Please try again.');
            }
        }



         
         
         
         
         // Ensure all dashboard buttons are visible
         function ensureAllButtonsVisible() {
             const buttons = document.querySelectorAll('button');
             buttons.forEach(button => {
                 button.style.setProperty('display', 'block', 'important');
                 button.style.setProperty('visibility', 'visible', 'important');
                 button.style.setProperty('opacity', '1', 'important');
             });
             console.log('✅ All dashboard buttons visibility ensured');
         }
         
         // Show profile section function
         async function showProfileSection() {
             document.getElementById('dashboardContent').innerHTML = `
                 <div class="bg-white rounded-lg shadow p-6">
                     <h2 class="text-xl font-semibold mb-4">My Profile</h2>
                     <div class="space-y-4">
                         <div class="bg-gray-50 p-4 rounded-lg">
                             <h3 class="font-semibold text-gray-800 mb-2">Profile Information</h3>
                             <div class="space-y-2">
                                 <p><strong>Name:</strong> <span id="profileNameCard">Loading...</span></p>
                                 <p><strong>Email:</strong> <span id="profileEmailCard">Loading...</span></p>
                                 <p><strong>Role:</strong> <span id="profileRoleCard">Loading...</span></p>
                             </div>
                         </div>
                     </div>
                 </div>
             `;
             
             // Load role for profile section
             await loadProfileRole();
         }
         
         // Load role for profile section
         async function loadProfileRole() {
             try {
                 const token = localStorage.getItem('token');
                 if (!token) {
                     document.getElementById('profileRole').textContent = 'No Resume Uploaded';
                     return;
                 }
                 
                 const response = await fetch('http://localhost:8005/api/user-resume', {
                     headers: {
                         'Authorization': `Bearer ${token}`
                     }
                 });
                 
                 if (response.ok) {
                     const data = await response.json();
                     const role = data.role || 'No Resume Uploaded';
                     document.getElementById('profileRole').textContent = role;
                 } else {
                     document.getElementById('profileRole').textContent = 'No Resume Uploaded';
                 }
             } catch (error) {
                 console.error('Error loading profile role:', error);
                 document.getElementById('profileRole').textContent = 'Error loading role';
             }
         }
         
         // Show jobs section function
         function showJobsSection() {
             document.getElementById('dashboardContent').innerHTML = `
                 <div class="bg-white rounded-lg shadow p-6">
                     <h2 class="text-xl font-semibold mb-4">Browse Jobs</h2>
                     <div class="space-y-4">
                         <div class="bg-blue-50 p-4 rounded-lg">
                             <h3 class="font-semibold text-blue-800 mb-2">Available Jobs</h3>
                             <p>Search and apply for job opportunities that match your skills and experience.</p>
                         </div>
                         <div class="bg-gray-50 p-4 rounded-lg">
                             <h3 class="font-semibold text-gray-800 mb-2">Job Categories</h3>
                             <div class="grid grid-cols-2 gap-4 text-sm">
                                 <div>• Software Development</div>
                                 <div>• Data Science</div>
                                 <div>• Marketing</div>
                                 <div>• Sales</div>
                                 <div>• Design</div>
                                 <div>• Operations</div>
                             </div>
                         </div>
                         <div class="bg-green-50 p-4 rounded-lg">
                             <h3 class="font-semibold text-green-800 mb-2">Job Search Tips</h3>
                             <p>Use keywords from your profile to find relevant job postings.</p>
                         </div>
                     </div>
                 </div>
             `;
             
             // Load applications after dashboard is shown
             setTimeout(() => {
                 loadMyApplications();
             }, 500);
         }
         
         // Show my applications section function
         function showMyApplicationsSection() {
             document.getElementById('dashboardContent').innerHTML = `
                 <div class="bg-white rounded-lg shadow p-6">
                     <h2 class="text-xl font-semibold mb-4">My Applications</h2>
                     <div class="space-y-4">
                         <div class="bg-green-50 p-4 rounded-lg">
                             <h3 class="font-semibold text-green-800 mb-2">Application Status</h3>
                             <p>Track your job applications and their current status.</p>
                         </div>
                         <div class="bg-gray-50 p-4 rounded-lg">
                             <h3 class="font-semibold text-gray-800 mb-2">Recent Applications</h3>
                             <div id="myApplicationsList" class="space-y-2 text-sm">
                                 <div class="text-center text-gray-500 py-4">
                                     <i class="fas fa-spinner fa-spin text-lg mb-2"></i>
                                     <p>Loading applications...</p>
                                 </div>
                             </div>
                         </div>
                         <div class="bg-blue-50 p-4 rounded-lg">
                             <h3 class="font-semibold text-blue-800 mb-2">Application Tips</h3>
                             <p>Make sure your profile is up-to-date before applying to jobs.</p>
                         </div>
                     </div>
                 </div>
             `;
         }
         
         // Logout function
         function logout() {
             localStorage.removeItem('token');
             localStorage.removeItem('user');
             // Show the homepage again
             document.getElementById('homepageContent').style.display = 'block';
             document.querySelector('nav').style.display = 'block';
             document.getElementById('dashboardContainer').classList.add('hidden');
         }
         
         // Modal functions
         function showLoginModal() {
             document.getElementById('loginModal').classList.remove('hidden');
         }
         
         function hideLoginModal() {
             document.getElementById('loginModal').classList.add('hidden');
         }
         
         function showRegisterModal() {
             document.getElementById('registerModal').classList.remove('hidden');
         }
         
         function hideRegisterModal() {
             document.getElementById('registerModal').classList.add('hidden');
         }
         
         // Login functionality
         async function handleLogin(event) {
             event.preventDefault();
             const form = event.target;
             const formData = new FormData(form);
             
             try {
                 const response = await fetch('http://localhost:8005/api/login', {
                     method: 'POST',
                     headers: {
                         'Content-Type': 'application/json',
                     },
                     body: JSON.stringify({
                         email: formData.get('email'),
                         password: formData.get('password')
                     })
                 });
                 
                 if (response.ok) {
                     const data = await response.json();
                     localStorage.setItem('token', data.access_token);
                     localStorage.setItem('user', JSON.stringify(data.user));
                     hideLoginModal();
                     // Clear any existing dashboard content first
                     document.getElementById('dashboardContainer').innerHTML = '';
                    // Hide homepage content and show dashboard
                    await showDashboard();
                 } else {
                     const error = await response.text();
                     alert('Login failed: ' + error);
                 }
             } catch (error) {
                 alert('Network error. Please try again.');
             }
         }
         
         // Function to clear all cached data and force fresh extraction
         async function clearAllCachedData() {
             try {
                 const token = localStorage.getItem('token');
                 if (token) {
                     // Clear cache on server
                     const response = await fetch('http://localhost:8005/api/clear-cache', {
                         method: 'POST',
                         headers: {
                             'Authorization': `Bearer ${token}`
                         }
                     });
                     
                     if (response.ok) {
                         console.log('✅ Server cache cleared successfully');
                     }
                 }
                 
                 // Clear localStorage
                 localStorage.removeItem('user');
                 console.log('✅ LocalStorage cleared successfully');
                 
                 // Reload dashboard with fresh data
                 await showDashboard();
                 
             } catch (error) {
                 console.error('❌ Error clearing cached data:', error);
             }
         }
         
         // Function to force refresh all data
         async function forceRefreshData() {
             try {
                 console.log('🔄 Forcing data refresh...');
                 
                 // Clear localStorage
                 localStorage.removeItem('user');
                 
                 // Clear server cache
                 const token = localStorage.getItem('token');
                 if (token) {
                     await fetch('http://localhost:8005/api/clear-cache', {
                         method: 'POST',
                         headers: {
                             'Authorization': `Bearer ${token}`
                         }
                     });
                 }
                 
                 // Force reload of all profile data
                 await loadProfileData();
                 await loadProfileCard();
                 
                 // Reload dashboard
                 await showDashboard();
                 
                 console.log('✅ Data refresh completed');
                 
             } catch (error) {
                 console.error('❌ Error refreshing data:', error);
             }
         }
         
         // Register functionality
         async function handleRegister(event) {
             event.preventDefault();
             const form = event.target;
             const formData = new FormData(form);
             
             try {
                 const response = await fetch('http://localhost:8005/api/register', {
                     method: 'POST',
                     headers: {
                         'Content-Type': 'application/json',
                     },
                     body: JSON.stringify({
                        name: formData.get('name'),
                         email: formData.get('email'),
                         phone: formData.get('phone'),
                         role: formData.get('role'),
                         password: formData.get('password')
                     })
                 });
                 
                 if (response.ok) {
                     const data = await response.json();
                     alert('Registration successful! Please login.');
                     hideRegisterModal();
                     showLoginModal();
                 } else {
                     const error = await response.text();
                     alert('Registration failed: ' + error);
                 }
             } catch (error) {
                 alert('Network error. Please try again.');
             }
         }
         
         
         
        // Auto-refresh token function
        async function refreshToken() {
            try {
                console.log('🔄 Token expired, redirecting to login...');
                
                // Clear localStorage and redirect to login
                localStorage.removeItem('token');
                localStorage.removeItem('user');
                
                // Show login form
                showLoginForm();
                
                return null;
            } catch (error) {
                console.error('Error in token refresh:', error);
                return null;
            }
        }
         
         // Resume Upload Functions
         // Load user's saved resume information
         async function loadResumeStatus() {
             let token = localStorage.getItem('token');
             if (!token) {
                 const resumeStatusElement = document.getElementById('resumeStatus');
                 if (resumeStatusElement) {
                     resumeStatusElement.innerHTML = `
                         <p class="text-gray-600">Please login to view resume status</p>
                     `;
                 }
                 return;
             }
             
             try {
                 let response = await fetch('http://localhost:8005/api/user-resume', {
                     headers: {
                         'Authorization': `Bearer ${token}`
                     }
                 });
                 
                 // If token is invalid, try to refresh it
                 if (response.status === 401) {
                     console.log('🔄 Token invalid, refreshing...');
                     const newToken = await refreshToken();
                     if (newToken) {
                         // Retry with new token
                         response = await fetch('http://localhost:8005/api/user-resume', {
                             headers: {
                                 'Authorization': `Bearer ${newToken}`
                             }
                         });
                     }
                 }
                 
                 if (response.ok) {
                     const data = await response.json();
                     displayResumeStatus(data);
                 } else {
                     const resumeStatusElement = document.getElementById('resumeStatus');
                     if (resumeStatusElement) {
                         resumeStatusElement.innerHTML = `
                             <div class="bg-gray-50 border border-gray-200 rounded-lg p-3">
                                 <div class="flex items-center">
                                     <i class="fas fa-file-upload text-gray-400 mr-2"></i>
                                     <span class="text-gray-600">No resume uploaded yet</span>
                                 </div>
                             </div>
                         `;
                     }
                 }
             } catch (error) {
                 const resumeStatusElement = document.getElementById('resumeStatus');
                 if (resumeStatusElement) {
                     resumeStatusElement.innerHTML = `
                         <p class="text-gray-600">Error loading resume status</p>
                     `;
                 }
             }
         }
         
         // Display resume status
         function displayResumeStatus(data) {
             const resumeStatusDiv = document.getElementById('resumeStatus');
             const extractedDataDiv = document.getElementById('extractedResumeData');
             
             if (data.has_resume && data.resume_data) {
                 const resumeData = data.resume_data;
                 const userProfile = data.user_profile || {};
                 
                 // Get filename and upload date from user profile
                 const filename = userProfile.resume_filename || 'Unknown';
                 const uploadTimestamp = userProfile.resume_upload_date || Date.now() / 1000;
                 const uploadDate = new Date(uploadTimestamp * 1000).toLocaleDateString();
                 
                 resumeStatusDiv.innerHTML = `
                     <div class="bg-green-50 border border-green-200 rounded-lg p-3">
                         <div class="flex items-center mb-2">
                             <i class="fas fa-check-circle text-green-600 mr-2"></i>
                             <span class="text-green-800 font-semibold">Resume Uploaded</span>
                         </div>
                         <div class="text-sm text-gray-600 space-y-1">
                             <p><strong>File:</strong> <span class="break-all text-xs">${filename}</span></p>
                             <p><strong>Uploaded:</strong> ${uploadDate}</p>
                             <p><strong>Status:</strong> Saved successfully</p>
                         </div>
                         <div class="mt-3 text-xs text-gray-500">
                             <i class="fas fa-info-circle mr-1"></i>Upload a new resume to replace this one
                         </div>
                     </div>
                 `;
                 
                 // Display extracted resume data
                 displayExtractedResumeData(resumeData);
             } else {
                 resumeStatusDiv.innerHTML = `
                     <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3">
                         <div class="flex items-center">
                             <i class="fas fa-exclamation-triangle text-yellow-600 mr-2"></i>
                             <span class="text-yellow-800">No resume uploaded yet</span>
                         </div>
                         <p class="text-sm text-gray-600 mt-1">Upload your resume to get started</p>
                     </div>
                 `;
                 
                 // Hide extracted data section
                 if (extractedDataDiv) {
                     extractedDataDiv.classList.add('hidden');
                 }
             }
             
             // Ensure upload button is always visible
             ensureUploadButtonVisible();
         }
         
         function displayExtractedResumeData(resumeData) {
             const extractedDataDiv = document.getElementById('extractedResumeData');
             if (!extractedDataDiv) return;
             
             // Show the extracted data section
             extractedDataDiv.classList.remove('hidden');
             
             // Populate extracted data fields
             document.getElementById('extractedName').textContent = resumeData.name || 'Not found';
             document.getElementById('extractedRole').textContent = resumeData.role || 'Not found';
             document.getElementById('extractedEmail').textContent = resumeData.email || 'Not found';
             document.getElementById('extractedPhone').textContent = resumeData.phone || 'Not found';
             document.getElementById('extractedExperience').textContent = resumeData.experience?.display || 'Not found';
             document.getElementById('extractedLocation').textContent = resumeData.location || 'Not found';
             document.getElementById('extractedSkillsCount').textContent = resumeData.skills?.length || 0;
             
            // Display skills
            const skillsDiv = document.getElementById('extractedSkills');
            if (resumeData.skills && resumeData.skills.length > 0) {
                skillsDiv.innerHTML = resumeData.skills.map(skill => 
                    `<span class="inline-block bg-blue-100 text-blue-800 text-xs px-3 py-1 rounded-full mr-2 mb-2 font-medium border border-blue-200">${skill}</span>`
                ).join('');
            } else {
                skillsDiv.innerHTML = '<span class="text-red-500 text-sm font-medium">No skills found</span>';
            }
         }
         
         // Ensure upload button is always visible
         function ensureUploadButtonVisible() {
             const uploadButtonDiv = document.getElementById('uploadButtonContainer');
             const uploadButton = uploadButtonDiv?.querySelector('button[onclick*="resumeFile"]');
             const removeButton = uploadButtonDiv?.querySelector('button[onclick*="removeResume"]');
             
             if (uploadButtonDiv) {
                 uploadButtonDiv.style.setProperty('display', 'block', 'important');
                 uploadButtonDiv.style.setProperty('visibility', 'visible', 'important');
                 uploadButtonDiv.style.setProperty('opacity', '1', 'important');
                 console.log('✅ Upload button container visibility ensured');
             }
             
             if (uploadButton) {
                 uploadButton.style.setProperty('display', 'block', 'important');
                 uploadButton.style.setProperty('visibility', 'visible', 'important');
                 uploadButton.style.setProperty('opacity', '1', 'important');
                 uploadButton.style.setProperty('background-color', '#059669', 'important');
                 uploadButton.style.setProperty('border', '2px solid #059669', 'important');
                 uploadButton.style.setProperty('color', 'white', 'important');
                 console.log('✅ Upload button visibility and color ensured');
             }
             
             if (removeButton) {
                 removeButton.style.setProperty('display', 'block', 'important');
                 removeButton.style.setProperty('visibility', 'visible', 'important');
                 removeButton.style.setProperty('opacity', '1', 'important');
                 removeButton.style.setProperty('background-color', '#dc2626', 'important');
                 removeButton.style.setProperty('border', '2px solid #dc2626', 'important');
                 removeButton.style.setProperty('color', 'white', 'important');
                 console.log('✅ Remove button visibility and color ensured');
             }
            
            // Also ensure file inputs are accessible
            const fileInputMain = document.getElementById('resumeFileMain');
            const fileInputDashboard = document.getElementById('resumeFileDashboard');
            
            if (fileInputMain) {
                fileInputMain.style.setProperty('display', 'none', 'important');
                console.log('✅ Main file input ensured');
            }
            if (fileInputDashboard) {
                fileInputDashboard.style.setProperty('display', 'none', 'important');
                console.log('✅ Dashboard file input ensured');
            }
         }
         
         // Resume upload function
         async function uploadResumeFile(event) {
             const file = event.target.files[0];
             if (!file) return;
             
             if (file.type !== 'application/pdf') {
                 alert('Please upload a PDF file');
                 return;
             }
             
             // Get or refresh token
             let token = localStorage.getItem('token');
             if (!token) {
                 alert('Please login first to upload resume');
                 return;
             }
             
             const formData = new FormData();
             formData.append('file', file);
             
             try {
                 let response = await fetch('http://localhost:8005/api/upload-resume', {
                     method: 'POST',
                     headers: {
                         'Authorization': `Bearer ${token}`
                     },
                     body: formData
                 });
                 
                 // If token is invalid, try to refresh it
                 if (response.status === 401) {
                     console.log('🔄 Token invalid, refreshing...');
                     const newToken = await refreshToken();
                     if (newToken) {
                         // Retry with new token
                         response = await fetch('http://localhost:8005/api/upload-resume', {
                             method: 'POST',
                             headers: {
                                 'Authorization': `Bearer ${newToken}`
                             },
                             body: formData
                         });
                     }
                 }
                 
                 if (response.ok) {
                     const data = await response.json();
                     console.log('✅ Upload successful:', data);
                     
                     console.log('✅ Upload completed successfully');
                     
                     // Update resume status display
                     await loadResumeStatus();
                     
                     // Ensure upload button remains visible
                     ensureUploadButtonVisible();
                     
                     alert('Resume uploaded and saved successfully!');
                 } else {
                     const errorData = await response.json();
                     console.error('Upload error:', errorData);
                     alert('Error uploading resume: ' + (errorData.detail || 'Unknown error'));
                 }
             } catch (error) {
                 console.error('Network error:', error);
                 alert('Network error. Please try again.');
             }
         }
         
         // Remove resume function
         async function removeResume() {
             if (!confirm('Are you sure you want to remove your resume? This action cannot be undone.')) {
                 return;
             }
             
             try {
                 const token = localStorage.getItem('token');
                 if (!token) {
                     alert('Please login first');
                     return;
                 }
                 
                const response = await fetch('http://localhost:8005/api/remove-resume', {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.status === 401) {
                    const newToken = await refreshToken();
                    if (newToken) {
                        const retryResponse = await fetch('http://localhost:8005/api/remove-resume', {
                            method: 'DELETE',
                            headers: {
                                'Authorization': `Bearer ${newToken}`
                            }
                        });
                        
                        if (retryResponse.ok) {
                            const data = await retryResponse.json();
                            if (data.success) {
                                alert('Resume removed successfully!');
                            } else {
                                alert(data.message || 'No resume found to remove');
                            }
                            await loadResumeStatus();
                        } else {
                            alert('Error removing resume');
                        }
                    }
                } else if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        alert('Resume removed successfully!');
                    } else {
                        alert(data.message || 'No resume found to remove');
                    }
                    await loadResumeStatus();
                } else {
                    alert('Error removing resume');
                }
             } catch (error) {
                 console.error('Error removing resume:', error);
                 alert('Network error. Please try again.');
             }
         }
         
         // AI Analysis Functions - Auto-detects fresher vs experienced
         async function runMLAnalysis() {
             console.log('🔍 Starting AI Career Analysis...');
             const token = localStorage.getItem('token');
             if (!token) {
                 alert('Please login first');
                 return;
             }
             
             try {
                 console.log('📡 Making API request for AI analysis...');
                 const response = await fetch('http://localhost:8005/api/ai-resume-analysis', {
                     method: 'POST',
                     headers: {
                         'Authorization': `Bearer ${token}`,
                         'Content-Type': 'application/json',
                         'Cache-Control': 'no-cache',
                         'Pragma': 'no-cache'
                     }
                 });
                 
                 console.log('📊 Response status:', response.status);
                 
                 if (response.ok) {
                     const data = await response.json();
                     console.log('✅ Analysis data received:', data);
                     
                     // Auto-detect if candidate is fresher or experienced based on experience
                     const experience = data.experience?.years || data.experience?.total_years || 0;
                     const isFresher = experience <= 1; // Consider 1 year or less as fresher
                     
                     console.log(`🎯 Experience detected: ${experience} years - ${isFresher ? 'Fresher' : 'Experienced'}`);
                     
                     if (isFresher) {
                         // For freshers, also get fresher-specific analysis
                         try {
                             const fresherResponse = await fetch('http://localhost:8005/api/fresher-career-analysis', {
                                 method: 'GET',
                                 headers: {
                                     'Authorization': `Bearer ${token}`
                                 }
                             });
                             
                             if (fresherResponse.ok) {
                                 const fresherData = await fresherResponse.json();
                                 // Combine both analyses for freshers
                                 data.fresher_analysis = fresherData.analysis;
                                 console.log('✅ Fresher analysis combined');
                             }
                         } catch (fresherError) {
                             console.log('⚠️ Fresher analysis not available, using main analysis');
                         }
                     }
                     
                     displayAIAnalysisResults(data, isFresher);
                 } else {
                     const error = await response.text();
                     console.error('❌ API Error:', error);
                     alert('AI Analysis failed: ' + error);
                 }
             } catch (error) {
                 console.error('❌ Network Error:', error);
                 alert('Network error. Please try again.');
             }
         }
         
         
         function displayAIAnalysisResults(analysis, isFresher = false) {
             console.log('🎨 Displaying AI Analysis Results...', isFresher ? '(Fresher)' : '(Experienced)');
             let resultsDiv = document.getElementById('aiAnalysisResults');
             if (!resultsDiv) {
                 console.log('🔧 Creating results div...');
                 // Create the div if it doesn't exist
                 resultsDiv = document.createElement('div');
                 resultsDiv.id = 'aiAnalysisResults';
                 resultsDiv.className = 'hidden';
                 // Find a good place to insert it (after the ML analysis card)
                 const mlCard = document.querySelector('.bg-white.rounded-lg.shadow.p-6');
                 if (mlCard && mlCard.parentNode) {
                     mlCard.parentNode.insertBefore(resultsDiv, mlCard.nextSibling);
                 } else {
                     // Fallback: append to body
                     document.body.appendChild(resultsDiv);
                 }
                 console.log('✅ Results div created and inserted');
             }
             
             console.log('📋 Analysis data:', analysis);
             
            // Determine if fresher based on analysis data
            const experienceYears = analysis.candidate_profile?.experience_years || 0;
            const isActuallyFresher = experienceYears === 0 || experienceYears < 1;
             
             resultsDiv.classList.remove('hidden');
             resultsDiv.innerHTML = `
                 <div class="mt-6 space-y-6">
                     <div class="bg-purple-50 p-6 rounded-lg">
                         <h3 class="text-2xl font-bold text-purple-800 mb-4">
                             <i class="fas fa-robot mr-2"></i>🤖 ${isActuallyFresher ? 'AI Fresher Career Analysis' : 'AI Experienced Career Analysis'}
                         </h3>
                         <p class="text-purple-700 mb-4">${isActuallyFresher ? 'Personalized career path and learning roadmap for freshers' : 'Advanced career insights and growth recommendations for experienced professionals'}</p>
                     </div>
                     
                     <!-- Candidate Profile -->
                     <div class="bg-white p-6 rounded-lg shadow">
                         <h4 class="text-xl font-semibold text-blue-800 mb-4">
                             👤 Candidate Profile
                         </h4>
                         <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                             <div>
                                 <p class="font-medium">Name: ${analysis.candidate_profile?.name || 'N/A'}</p>
                                 <p class="font-medium">Role: ${analysis.candidate_profile?.role || 'N/A'}</p>
                                 <p class="font-medium">Experience Level: ${analysis.candidate_profile?.experience_years >= 3.7 ? 'Mid Level' : analysis.candidate_profile?.experience_years >= 1 ? 'Junior Level' : 'Entry Level'}</p>
                             </div>
                             <div>
                                 <p class="font-medium">Career Stage: ${analysis.career_path_analysis?.current_level || 'N/A'}</p>
                                 <p class="font-medium">Skills Count: ${analysis.skill_analysis?.total_skills || 0}</p>
                                 <p class="font-medium">Location: ${analysis.candidate_profile?.location || 'N/A'}</p>
                             </div>
                         </div>
                         <div class="mt-4">
                             <p class="text-gray-700">${analysis.ai_insights?.insights?.join('. ') || 'Profile summary not available'}</p>
                         </div>
                     </div>
                     
                     <!-- Skill Analysis -->
                     <div class="bg-white p-6 rounded-lg shadow">
                         <h4 class="text-xl font-semibold text-green-800 mb-4">
                             <i class="fas fa-tools mr-2"></i>🛠️ Skill Analysis
                         </h4>
                         <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                             <div>
                                 <p class="font-medium">Total Skills: ${analysis.skill_analysis?.total_skills || 0}</p>
                                 <p class="font-medium">Strength Areas: ${(analysis.skill_analysis?.strength_areas || []).join(', ') || 'N/A'}</p>
                             </div>
                         </div>
                         <div class="mt-4">
                             <h5 class="font-semibold">Skill Categories:</h5>
                             <div class="grid grid-cols-1 md:grid-cols-2 gap-2 mt-2">
                                 ${Object.entries(analysis.skill_analysis?.skill_categories || {}).map(([category, skills]) => 
                                     `<div class="bg-gray-100 p-3 rounded border border-gray-200">
                                         <p class="font-medium text-sm text-gray-800">${category}:</p>
                                         <p class="text-xs text-gray-700">${skills.join(', ')}</p>
                                     </div>`
                                 ).join('')}
                             </div>
                         </div>
                     </div>
                     
                     <!-- Career Progression -->
                     <div class="bg-white p-6 rounded-lg shadow">
                         <h4 class="text-xl font-semibold text-purple-800 mb-4">
                             <i class="fas fa-chart-line mr-2"></i>📈 Career Progression
                         </h4>
                         <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                             <div>
                                 <p class="font-medium">Current Level: ${analysis.career_path_analysis?.current_level || 'N/A'}</p>
                             </div>
                             <div>
                                 <p class="font-medium">Career Path:</p>
                                 <div class="text-sm">
                                    ${analysis.career_path_analysis?.career_path || 'N/A'}
                                 </div>
                             </div>
                         </div>
                         <div class="mt-4">
                             <h5 class="font-semibold">Next Steps:</h5>
                             <ul class="list-disc list-inside mt-2">
                                ${(analysis.career_path_analysis?.next_steps || []).map(step => 
                                     `<li class="text-sm">${step}</li>`
                                 ).join('')}
                             </ul>
                         </div>
                     </div>
                     
                     <!-- Recommendations -->
                     <div class="bg-white p-6 rounded-lg shadow">
                         <h4 class="text-xl font-semibold text-yellow-800 mb-4">
                             <i class="fas fa-lightbulb mr-2"></i>💡 Recommendations
                         </h4>
                         <div class="space-y-4">
                             ${isActuallyFresher ? `
                             <div>
                                 <h5 class="font-semibold text-green-800">Immediate Actions:</h5>
                         <ul class="list-disc list-inside mt-2">
                                     ${(analysis.recommendations?.immediate_actions || []).map(rec => 
                                 `<li class="text-sm">${rec}</li>`
                             ).join('')}
                         </ul>
                             </div>
                             <div>
                                 <h5 class="font-semibold text-blue-800">Skill Development:</h5>
                                 <ul class="list-disc list-inside mt-2">
                                     ${(analysis.recommendations?.skill_development || []).map(rec => 
                                         `<li class="text-sm">${rec}</li>`
                                     ).join('')}
                                 </ul>
                             </div>
                             <div>
                                 <h5 class="font-semibold text-purple-800">Career Preparation:</h5>
                                 <ul class="list-disc list-inside mt-2">
                                     ${(analysis.recommendations?.career_preparation || []).map(rec => 
                                         `<li class="text-sm">${rec}</li>`
                                     ).join('')}
                                 </ul>
                             </div>
                             ` : `
                             <div>
                                 <h5 class="font-semibold text-green-800">Immediate Actions:</h5>
                                 <ul class="list-disc list-inside mt-2">
                                     ${(analysis.recommendations?.immediate_actions || []).map(rec => 
                                         `<li class="text-sm">${rec}</li>`
                                     ).join('')}
                                 </ul>
                             </div>
                             <div>
                                 <h5 class="font-semibold text-blue-800">Skill Development:</h5>
                                 <ul class="list-disc list-inside mt-2">
                                     ${(analysis.recommendations?.skill_development || []).map(rec => 
                                         `<li class="text-sm">${rec}</li>`
                                     ).join('')}
                                 </ul>
                             </div>
                             <div>
                                 <h5 class="font-semibold text-purple-800">Career Advancement:</h5>
                                 <ul class="list-disc list-inside mt-2">
                                     ${(analysis.recommendations?.career_advancement || []).map(rec => 
                                         `<li class="text-sm">${rec}</li>`
                                     ).join('')}
                                 </ul>
                             </div>
                             `}
                         </div>
                     </div>
                     
                     <!-- AI Insights -->
                     <div class="bg-white p-6 rounded-lg shadow">
                         <h4 class="text-xl font-semibold text-indigo-800 mb-4">
                             <i class="fas fa-brain mr-2"></i>🤖 AI Insights
                         </h4>
                         <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                             <div>
                                 <p class="font-medium">Career Stage: ${analysis.ai_insights?.career_stage || 'N/A'}</p>
                                 <p class="font-medium">Market Readiness: ${analysis.ai_insights?.market_readiness || 'N/A'}</p>
                             </div>
                             <div>
                                 <p class="font-medium">Growth Potential: ${analysis.ai_insights?.growth_potential || 'N/A'}</p>
                                 <p class="font-medium">Analysis Type: ${analysis.ai_insights?.analysis_type || 'General Analysis'}</p>
                             </div>
                         </div>
                         <div class="mt-4">
                             <h5 class="font-semibold">Recommended Actions:</h5>
                             <ul class="list-disc list-inside mt-2">
                                ${(analysis.recommendations?.immediate_actions || []).map(action => 
                                     `<li class="text-sm">${action}</li>`
                                 ).join('')}
                             </ul>
                         </div>
                     </div>
                     
                     ${isActuallyFresher ? `
                     <!-- Fresher-Specific Analysis -->
                     <div class="bg-green-50 p-6 rounded-lg border border-green-200">
                         <h4 class="text-xl font-semibold text-green-800 mb-4">
                             <i class="fas fa-graduation-cap mr-2"></i>🎓 Fresher Career Path
                         </h4>
                         <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                             <div>
                                 <p class="font-medium">Career Stage: ${analysis.candidate_profile?.career_stage || 'Fresher'}</p>
                                 <p class="font-medium">Experience Level: ${analysis.candidate_profile?.experience_level || 'Entry Level'}</p>
                             </div>
                             <div>
                                <p class="font-medium">Timeline: ${analysis.career_path_analysis?.timeline || '0-2 years → 2-4 years → 4-6 years → 6+ years'}</p>
                                <p class="font-medium">Entry Level: ${analysis.career_path_analysis?.career_path || 'Fresher → Junior Developer → Mid Developer → Senior Developer'}</p>
                             </div>
                         </div>
                         <div class="mt-4">
                             <h5 class="font-semibold">Career Progression:</h5>
                            <div class="text-sm text-gray-700 mb-2">
                                ${analysis.career_path_analysis?.career_path || 'Fresher → Junior Developer → Mid Developer → Senior Developer'}
                             </div>
                         </div>
                         <div class="mt-4">
                             <h5 class="font-semibold">Skills to Learn:</h5>
                             <div class="flex flex-wrap gap-2 mt-2">
                                ${(analysis.career_path_analysis?.skills_to_learn || []).map(skill => 
                                     `<span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-sm">${skill}</span>`
                                 ).join('')}
                             </div>
                         </div>
                         <div class="mt-4">
                             <h5 class="font-semibold">Next Steps:</h5>
                             <ul class="list-disc list-inside mt-2">
                                ${(analysis.career_path_analysis?.next_steps || []).map(step => 
                                    `<li class="text-sm">${step}</li>`
                                ).join('')}
                             </ul>
                         </div>
                         <div class="mt-4">
                             <h5 class="font-semibold">Learning Roadmap:</h5>
                            <div class="space-y-2 mt-2">
                                ${(analysis.career_path_analysis?.learning_roadmap || []).map(roadmap => `
                                     <div class="bg-white p-3 rounded border">
                                        <p class="text-sm text-gray-700">${roadmap}</p>
                                     </div>
                                 `).join('')}
                             </div>
                         </div>
                         <div class="mt-4">
                             <h5 class="font-semibold">Fresher Recommendations:</h5>
                             <ul class="list-disc list-inside mt-2">
                                ${(analysis.career_path_analysis?.fresher_recommendations || []).map(rec => 
                                     `<li class="text-sm">${rec}</li>`
                                 ).join('')}
                             </ul>
                         </div>
                     </div>
                     ` : ''}
                     
                     <!-- Skill Gap Analysis -->
                     <div class="bg-white p-6 rounded-lg shadow">
                         <h4 class="text-xl font-semibold text-blue-800 mb-4">
                             <i class="fas fa-chart-line mr-2"></i>Skill Gap Analysis
                         </h4>
                         <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                             <div>
                                 <p class="font-medium">Missing Skills: ${analysis.skill_gap_analysis?.missing_skills?.length || 0}</p>
                                 <p class="font-medium text-blue-600">Total Extracted Skills: ${analysis.skill_gap_analysis?.total_extracted_skills || 0}</p>
                             </div>
                             <div>
                                 <p class="font-medium">Role Category: ${analysis.skill_gap_analysis?.role_category || 'N/A'}</p>
                                 <p class="font-medium">Total Required: ${analysis.skill_gap_analysis?.total_required || 0}</p>
                             </div>
                         </div>
                         <div class="mt-4">
                             <h5 class="font-semibold">Missing Skills:</h5>
                             <div class="flex flex-wrap gap-2 mt-2">
                                 ${(analysis.skill_gap_analysis?.missing_skills || []).map(skill => 
                                     `<span class="bg-red-100 text-red-800 px-2 py-1 rounded text-sm">${skill}</span>`
                                 ).join('')}
                             </div>
                         </div>
                         <div class="mt-4">
                             <h5 class="font-semibold">Recommendations:</h5>
                             <ul class="list-disc list-inside mt-2">
                                 ${(analysis.skill_gap_analysis?.recommendations || []).map(rec => 
                                     `<li class="text-sm">${rec}</li>`
                                 ).join('')}
                             </ul>
                         </div>
                     </div>
                     
                     <!-- Salary Projection -->
                     <div class="bg-white p-6 rounded-lg shadow">
                         <h4 class="text-xl font-semibold text-green-800 mb-4">
                             <i class="fas fa-rupee-sign mr-2"></i>Salary Projection
                         </h4>
                         <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                             <div>
                                <p class="font-medium text-lg">Projected Salary: ₹${analysis.salary_analysis?.projected_salary?.toLocaleString() || 'N/A'}</p>
                                <p class="font-medium">Experience Level: ${analysis.salary_analysis?.experience_level || 'N/A'}</p>
                                <p class="font-medium">Experience Years: ${analysis.salary_analysis?.experience_years || 'N/A'}</p>
                             </div>
                             <div>
                                 <p class="font-medium">Skills Count: ${analysis.skill_analysis?.total_skills || 'N/A'}</p>
                                 <p class="font-medium">Min Salary: ₹${analysis.salary_analysis?.min_salary?.toLocaleString() || 'N/A'}</p>
                                 <p class="font-medium">Max Salary: ₹${analysis.salary_analysis?.max_salary?.toLocaleString() || 'N/A'}</p>
                             </div>
                         </div>
                     </div>
                     
                     <!-- Location Growth Analysis -->
                     <div class="bg-white p-6 rounded-lg shadow">
                         <h4 class="text-xl font-semibold text-indigo-800 mb-4">
                             <i class="fas fa-map-marker-alt mr-2"></i>Location Growth Analysis
                         </h4>
                         <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                             <div>
                                <p class="font-medium">Current Location: ${analysis.industry_analysis?.current_location || 'N/A'}</p>
                                <p class="font-medium">Salary Multiplier: ${analysis.industry_analysis?.salary_multiplier || 'N/A'}</p>
                                <p class="font-medium">Growth Rate: ${analysis.industry_analysis?.growth_rate || 'N/A'}%</p>
                                <p class="font-medium">Tech Hub: ${analysis.industry_analysis?.is_tech_hub ? 'Yes' : 'No'}</p>
                             </div>
                         </div>
                         <div class="mt-4">
                             <h5 class="font-semibold">Alternative Locations:</h5>
                             <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-2">
                                ${(analysis.industry_analysis?.alternative_locations || []).map(loc => `
                                     <div class="bg-gray-50 p-3 rounded">
                                         <p class="font-medium">${loc.name}</p>
                                        <p class="text-sm">${loc.reason}</p>
                                        <p class="text-sm text-green-600">${loc.salary_boost}</p>
                                     </div>
                                 `).join('')}
                             </div>
                         </div>
                     </div>
                     
                     
                     <!-- Dashboard Content Area -->
                     <div id="dashboardContent" class="mt-6">
                         <!-- Content will be loaded here based on user actions -->
                     </div>
                     
                 </div>
             `;
         }
         
         // Set up event listeners
         document.addEventListener('DOMContentLoaded', function() {
             // Check authentication status on page load
             checkAuthStatus();
             
             // Modal buttons
             document.getElementById('loginBtn').onclick = showLoginModal;
             document.getElementById('registerBtn').onclick = showRegisterModal;
             document.getElementById('closeLoginModal').onclick = hideLoginModal;
             document.getElementById('closeRegisterModal').onclick = hideRegisterModal;
             
             // Form handlers
             document.getElementById('loginForm').onsubmit = handleLogin;
             document.getElementById('registerForm').onsubmit = handleRegister;
             
             // Modal switching
             document.getElementById('switchToRegister').onclick = function(e) {
                 e.preventDefault();
                 hideLoginModal();
                 showRegisterModal();
             };
             
             document.getElementById('switchToLogin').onclick = function(e) {
                 e.preventDefault();
                 hideRegisterModal();
                 showLoginModal();
             };
             
             // Check authentication
             checkAuth();
             
         });
        
        // Admin Dashboard Functions
        async function loadAdminDashboardStats() {
            try {
                const token = localStorage.getItem('token');
                if (!token) return;
                
                const response = await fetch('http://localhost:8005/api/admin/dashboard-stats', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    displayAdminStats(data);
                }
            } catch (error) {
                console.error('Error loading admin stats:', error);
            }
        }
        
        function displayAdminStats(stats) {
            const statsContainer = document.getElementById('adminStats');
            if (!statsContainer) return;
            
            statsContainer.innerHTML = `
                <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-6 rounded-xl border border-blue-200 text-center">
                    <div class="text-3xl font-bold text-blue-600">${stats.total_users}</div>
                    <div class="text-sm text-gray-600">Total Users</div>
                </div>
                <div class="bg-gradient-to-r from-green-50 to-emerald-50 p-6 rounded-xl border border-green-200 text-center">
                    <div class="text-3xl font-bold text-green-600">${stats.total_jobs}</div>
                    <div class="text-sm text-gray-600">Total Jobs</div>
                </div>
                <div class="bg-gradient-to-r from-orange-50 to-amber-50 p-6 rounded-xl border border-orange-200 text-center">
                    <div class="text-3xl font-bold text-orange-600">${stats.total_applications}</div>
                    <div class="text-sm text-gray-600">Total Applications</div>
                </div>
                <div class="bg-gradient-to-r from-purple-50 to-pink-50 p-6 rounded-xl border border-purple-200 text-center">
                    <div class="text-3xl font-bold text-purple-600">${stats.total_resumes}</div>
                    <div class="text-sm text-gray-600">Total Resumes</div>
                </div>
            `;
        }
        
        async function showAdminJobsSection() {
            document.getElementById('dashboardContent').innerHTML = `
                <div class="dashboard-card rounded-xl p-8 animate-fadeInUp">
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center space-x-3">
                            <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white text-xl shadow-lg">
                                <i class="fas fa-briefcase"></i>
                            </div>
                            <h2 class="text-2xl font-bold text-gray-800">Job Management</h2>
                        </div>
                        <button onclick="showAdminDashboard()" class="bg-gradient-to-r from-gray-500 to-gray-600 text-white px-4 py-2 rounded-lg hover:from-gray-600 hover:to-gray-700 transition-all duration-300 shadow-md hover:shadow-lg transform hover:scale-105">
                            <i class="fas fa-arrow-left mr-2"></i>Back to Dashboard
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-blue-50 p-6 rounded-lg border border-blue-200 shadow-lg hover:shadow-xl transition-all duration-300">
                            <h3 class="text-lg font-semibold text-blue-800 mb-4 flex items-center">
                                <i class="fas fa-plus-circle mr-2 text-blue-600"></i>Post New Job
                            </h3>
                            <form id="adminJobForm" class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                                        <i class="fas fa-briefcase mr-2 text-blue-500"></i>Job Title
                                    </label>
                                    <input type="text" name="title" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-300" placeholder="Enter job title" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                                        <i class="fas fa-building mr-2 text-green-500"></i>Company
                                    </label>
                                    <input type="text" name="company" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all duration-300" placeholder="Enter company name" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                                        <i class="fas fa-map-marker-alt mr-2 text-red-500"></i>Location
                                    </label>
                                    <input type="text" name="location" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all duration-300" placeholder="Enter job location" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                                        <i class="fas fa-align-left mr-2 text-purple-500"></i>Description
                                    </label>
                                    <textarea name="description" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all duration-300" placeholder="Describe the job role and responsibilities" required></textarea>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                                        <i class="fas fa-list-check mr-2 text-indigo-500"></i>Requirements
                                    </label>
                                    <textarea name="requirements" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-300" placeholder="List required skills and qualifications" required></textarea>
                                </div>
                                <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                                            <span class="mr-2 text-yellow-500 text-lg">₹</span>Salary Range (INR)
                                        </label>
                                        <div class="relative">
                                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                                <span class="text-gray-500 text-lg">₹</span>
                                </div>
                                            <input type="text" name="salary_range" class="w-full pl-8 pr-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 transition-all duration-300" placeholder="5,00,000 - 8,00,000" required>
                                        </div>
                                    </div>
                                <button type="submit" class="w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white px-4 py-2 rounded-md hover:from-blue-600 hover:to-purple-700 transition-all duration-300 shadow-md hover:shadow-lg transform hover:scale-105">
                                    <i class="fas fa-plus mr-2"></i>Post Job
                                </button>
                            </form>
                        </div>
                        
                        <div class="bg-gray-50 p-6 rounded-lg border border-gray-200 shadow-lg hover:shadow-xl transition-all duration-300">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                                <i class="fas fa-list mr-2 text-purple-500"></i>Existing Jobs
                            </h3>
                            <div id="adminJobsList" class="space-y-3">
                                <!-- Jobs will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Load existing jobs
            loadAdminJobs();
            
            // Handle job form submission
            document.getElementById('adminJobForm').onsubmit = async function(e) {
                e.preventDefault();
                await submitAdminJob();
            };
        }
        
        async function loadAdminJobs() {
            try {
                const token = localStorage.getItem('token');
                if (!token) return;
                
                const response = await fetch('http://localhost:8005/api/jobs', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    displayAdminJobs(data.jobs);
                } else if (handleTokenExpiration(response)) {
                    return;
                }
            } catch (error) {
                console.error('Error loading jobs:', error);
            }
        }
        
        function displayAdminJobs(jobs) {
            const jobsList = document.getElementById('adminJobsList');
            if (!jobsList) return;
            
            if (jobs.length === 0) {
                jobsList.innerHTML = `
                    <div class="text-center py-8">
                        <div class="w-16 h-16 bg-gradient-to-r from-gray-200 to-gray-300 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-briefcase text-gray-500 text-xl"></i>
                        </div>
                        <p class="text-gray-600 text-lg font-medium">No jobs posted yet</p>
                        <p class="text-gray-500 text-sm mt-2">Start by posting your first job listing</p>
                    </div>
                `;
                return;
            }
            
            jobsList.innerHTML = jobs.map(job => `
                <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-md hover:shadow-lg transition-all duration-300 hover:border-blue-300">
                    <div class="flex items-start justify-between mb-3">
                        <div class="flex-1">
                            <h4 class="font-semibold text-gray-800 text-lg mb-1">${job.title}</h4>
                            <p class="text-sm text-gray-600 mb-2 flex items-center">
                                <i class="fas fa-building mr-2 text-blue-500"></i>${job.company}
                            </p>
                            <p class="text-sm text-gray-600 mb-2 flex items-center">
                                <i class="fas fa-map-marker-alt mr-2 text-red-500"></i>${job.location}
                            </p>
                        </div>
                        <div class="text-right">
                            <span class="inline-block bg-gradient-to-r from-green-500 to-green-600 text-white px-4 py-2 rounded-full text-sm font-bold shadow-lg border-2 border-green-400">
                                <i class="fas fa-rupee-sign mr-1"></i>${job.salary_range || 'Salary TBD'}
                            </span>
                        </div>
                    </div>
                    <p class="text-sm text-gray-500 mb-3 leading-relaxed">
                        ${job.description.substring(0, 100)}${job.description.length > 100 ? '...' : ''}
                    </p>
                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-3">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <i class="fas fa-rupee-sign text-yellow-600 mr-2"></i>
                                <span class="text-sm font-medium text-gray-700">Salary:</span>
                            </div>
                            <span class="text-lg font-bold text-green-600">₹${job.salary_range || 'TBD'}</span>
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-xs text-gray-500">
                            <i class="fas fa-calendar mr-1"></i>${job.posted_date || 'Recently posted'}
                        </span>
                        <div class="flex space-x-2">
                            <button onclick="editJob(${job.id})" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-xs font-medium transition-colors">
                                <i class="fas fa-edit mr-1"></i>Edit
                            </button>
                            <button onclick="deleteJob(${job.id})" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-xs font-medium transition-colors">
                                <i class="fas fa-trash mr-1"></i>Delete
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        // Helper function to handle token expiration
        function handleTokenExpiration(response) {
            if (response.status === 401) {
                localStorage.removeItem('token');
                localStorage.removeItem('user');
                alert('Session expired. Please login again.');
                showLoginModal();
                return true;
            }
            return false;
        }

        // Check if user is logged in on page load
        function checkAuthStatus() {
            const token = localStorage.getItem('token');
            const user = localStorage.getItem('user');
            
            if (token && user) {
                // User is logged in, show dashboard
                showDashboard();
            } else {
                // User is not logged in, show homepage
                showHomepage();
            }
        }
        
        async function submitAdminJob() {
            try {
                const token = localStorage.getItem('token');
                if (!token) {
                    alert('Please login first');
                    showLoginModal();
                    return;
                }
                
                const form = document.getElementById('adminJobForm');
                const formData = new FormData(form);
                
                const jobData = {
                    title: formData.get('title'),
                    company: formData.get('company'),
                    location: formData.get('location'),
                    description: formData.get('description'),
                    requirements: formData.get('requirements'),
                    salary_range: formData.get('salary_range')
                };
                
                const response = await fetch('http://localhost:8005/api/jobs', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(jobData)
                });
                
                if (response.ok) {
                    alert('Job posted successfully!');
                    form.reset();
                    loadAdminJobs(); // Reload jobs list
                } else if (handleTokenExpiration(response)) {
                    return;
                } else {
                    const error = await response.text();
                    alert('Error posting job: ' + error);
                }
            } catch (error) {
                console.error('Error submitting job:', error);
                alert('Error posting job. Please try again.');
            }
        }
        
        async function showAdminApplicationsSection() {
            document.getElementById('dashboardContent').innerHTML = `
                <div class="dashboard-card rounded-xl p-8 animate-fadeInUp">
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center space-x-3">
                            <div class="w-14 h-14 bg-gradient-to-br from-slate-700 via-slate-800 to-slate-900 rounded-2xl flex items-center justify-center text-white text-2xl shadow-2xl border-2 border-pink-400">
                                <i class="fas fa-file-alt" style="color: #ec4899 !important;"></i>
                            </div>
                            <h2 class="text-3xl font-black" style="color: #1e293b;">Application Management</h2>
                        </div>
                        <button onclick="showAdminDashboard()" class="btn-professional btn-professional-secondary">
                            <i class="fas fa-arrow-left mr-2"></i>Back to Dashboard
                        </button>
                    </div>
                    
                    <div id="adminApplicationsList" class="space-y-4">
                        <!-- Applications will be loaded here -->
                    </div>
                </div>
            `;
            
            // Load applications
            loadAdminApplications();
        }
        
        async function loadAdminApplications() {
            try {
                const token = localStorage.getItem('token');
                if (!token) {
                    alert('Please login first');
                    showLoginModal();
                    return;
                }

                const response = await fetch('/api/admin/applications', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await response.json();
                const applications = data.applications || [];
                console.log('🔍 Applications data:', applications);
                console.log('🔍 First application AI suggestion:', applications[0]?.ai_suggestion);

                const applicationsHTML = `
                    <div class="overflow-x-auto">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Candidate</th>
                                    <th>Job Title</th>
                                    <th>Company</th>
                                    <th>Experience</th>
                                    <th>Skills</th>
                                    <th>Resume Score</th>
                                    <th>AI Suggestion</th>
                                    <th>Status</th>
                                    <th>Applied</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${applications.map(app => `
                                    <tr>
                                        <td>
                                            <div class="flex items-center gap-3">
                                                <div class="w-12 h-12 bg-gradient-to-br from-indigo-600 to-indigo-700 rounded-full flex items-center justify-center text-white font-black text-xl shadow-xl border-2 border-indigo-400">
                                                    ${(app.user_name || app.user_email || 'U').charAt(0).toUpperCase()}
                                                </div>
                                                <div>
                                                    <div class="font-black text-lg tracking-tight" style="color: #0f172a; text-shadow: 0 1px 2px rgba(0,0,0,0.05);">
                                                        ${app.user_name || app.user_email?.split('@')[0]?.toUpperCase() || 'CANDIDATE'}
                                                    </div>
                                                    <div class="text-sm font-semibold" style="color: #475569;">${app.user_email}</div>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="font-semibold text-gray-800">${app.job_title}</td>
                                        <td class="text-gray-700">${app.job_company}</td>
                                        <td class="font-medium text-gray-800">${app.user_experience_years} years</td>
                                        <td>
                                            <div class="flex flex-wrap gap-1">
                                                ${app.user_skills && app.user_skills.length > 0 ? app.user_skills.slice(0, 5).map(skill => `<span class="skill-tag" style="font-size: 11px; padding: 6px 12px;">${skill}</span>`).join('') : '<span class="text-gray-600 text-xs font-medium">No skills listed</span>'}
                                                ${app.user_skills && app.user_skills.length > 5 ? `<span class="text-xs font-bold" style="color: #6366f1;">+${app.user_skills.length - 5} more</span>` : ''}
                                            </div>
                                        </td>
                                        <td>
                                            ${generateCompactAIScoreDisplay(app.resume_score)}
                                        </td>
                                        <td>
                                            ${generateAISuggestionDisplay(app.ai_suggestion)}
                                        </td>
                                        <td><span class="status-badge status-${app.status}">${app.status}</span></td>
                                        <td class="font-medium text-gray-800">${new Date(app.applied_date).toLocaleDateString()}</td>
                                        <td>
                                            <div class="flex space-x-2">
                                                <button onclick="viewApplicationResume('${app.user_email}')" class="btn btn-primary btn-sm" title="View Resume">
                                                    <i class="fas fa-file-pdf"></i>
                                                </button>
                                                <select onchange="updateApplicationStatus(${app.id}, this.value)" class="form-select form-select-sm">
                                                    <option value="under_review" ${app.status === 'under_review' ? 'selected' : ''}>Under Review</option>
                                                    <option value="accepted" ${app.status === 'accepted' ? 'selected' : ''}>Accepted</option>
                                                    <option value="rejected" ${app.status === 'rejected' ? 'selected' : ''}>Rejected</option>
                                                </select>
                                            </div>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;

                document.getElementById('adminApplicationsList').innerHTML = applicationsHTML;
            } catch (error) {
                console.error('Error loading admin applications:', error);
                document.getElementById('adminApplicationsList').innerHTML = '<p class="text-red-500">Error loading applications</p>';
            }
        }

        // Helper function to generate compact AI score display
        function generateCompactAIScoreDisplay(score) {
            const percentage = Math.round(score * 100);
            let colorClass;
            
            if (score >= 0.8) {
                colorClass = 'ai-score-excellent';
            } else if (score >= 0.6) {
                colorClass = 'ai-score-good';
            } else if (score >= 0.4) {
                colorClass = 'ai-score-fair';
            } else {
                colorClass = 'ai-score-poor';
            }
            
            return `
                <div class="ai-score-card ${colorClass}" style="padding: 8px 12px; margin: 0;">
                    <div class="ai-score-circle" style="width: 40px; height: 40px; font-size: 14px; margin-right: 8px;">
                        ${percentage}%
                    </div>
                    <div class="ai-score-content">
                        <div class="ai-score-label" style="font-size: 12px; margin-bottom: 2px;">
                            <i class="fas fa-star ai-score-star" style="font-size: 12px;"></i>
                            AI Score
                        </div>
                    </div>
                </div>
            `;
        }

        // Helper function to generate AI suggestion display
        function generateAISuggestionDisplay(suggestion) {
            if (!suggestion) {
                return '<span class="ai-suggestion-badge ai-suggestion-gray">No Suggestion</span>';
            }

            const suggestionText = suggestion.suggestion.charAt(0).toUpperCase() + suggestion.suggestion.slice(1).replace('_', ' ');
            const confidenceText = suggestion.confidence.charAt(0).toUpperCase() + suggestion.confidence.slice(1);
            
            return `
                <div class="ai-suggestion-container" title="${suggestion.reason}">
                    <span class="ai-suggestion-badge ai-suggestion-${suggestion.color}">
                        <i class="fas fa-robot mr-1"></i>
                        ${suggestionText}
                    </span>
                    <div class="ai-suggestion-confidence">
                        <small>${confidenceText} Confidence</small>
                    </div>
                </div>
            `;
        }

        // Helper function to update application status
        async function updateApplicationStatus(applicationId, newStatus) {
            try {
                const token = localStorage.getItem('token');
                if (!token) {
                    alert('Please login first');
                    showLoginModal();
                    return;
                }

                const response = await fetch(`/api/admin/applications/${applicationId}/status`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ status: newStatus })
                });

                if (response.ok) {
                    showToast('Application status updated successfully', 'success');
                    loadAdminApplications(); // Refresh the list
                } else {
                    showToast('Error updating application status', 'error');
                }
            } catch (error) {
                console.error('Error updating application status:', error);
                showToast('Error updating application status', 'error');
            }
        }

        // Helper function to view application resume
        async function viewApplicationResume(userEmail) {
            try {
                const token = localStorage.getItem('token');
                if (!token) {
                    alert('Please login first');
                    showLoginModal();
                    return;
                }

                // Get user data to find resume file
                const userResponse = await fetch('/api/admin/users', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const userData = await userResponse.json();
                const user = userData.users.find(u => u.email === userEmail);
                
                if (user && user.resume_filename) {
                    // Open resume file in new tab
                    window.open(`/uploads/${user.resume_filename}`, '_blank');
                } else {
                    alert('Resume file not found');
                }
            } catch (error) {
                console.error('Error viewing resume:', error);
                alert('Error viewing resume');
            }
        }

        // Helper function to view application details
        function viewApplicationDetails(applicationId) {
            // This could open a modal with detailed application information
            alert(`Viewing details for application ${applicationId}`);
        }

        // Removed old implementation - now using table format with AI suggestions

        // User Management Functions
        async function showUserManagement() {
            document.getElementById('dashboardContent').innerHTML = `
                <div class="dashboard-card rounded-xl p-8 animate-fadeInUp">
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center space-x-3">
                            <div class="w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center text-white text-xl">
                                <i class="fas fa-users"></i>
                            </div>
                            <h2 class="text-2xl font-bold text-gray-800">User Management</h2>
                        </div>
                        <button onclick="showAdminDashboard()" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition duration-300">
                            <i class="fas fa-arrow-left mr-2"></i>Back to Dashboard
                        </button>
                    </div>
                    
                    <div class="mb-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-gray-800">All Users</h3>
                            <div class="flex space-x-2">
                                <button onclick="loadUsers()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition duration-300">
                                    <i class="fas fa-sync-alt mr-2"></i>Refresh
                                </button>
                            </div>
                        </div>
                        
                        <!-- Search and Filter Section -->
                        <div class="bg-gray-50 p-4 rounded-lg border border-gray-200 mb-6">
                            <h4 class="text-md font-semibold text-gray-700 mb-3">Search & Filter Users</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Search</label>
                                    <input type="text" id="userSearchInput" placeholder="Name, email, skills..." class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Domain</label>
                                    <input type="text" id="domainFilterInput" placeholder="e.g., IT, Finance, Healthcare" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Experience Range</label>
                                    <div class="flex space-x-2">
                                        <input type="number" id="minExpInput" placeholder="Min" min="0" max="50" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                        <input type="number" id="maxExpInput" placeholder="Max" min="0" max="50" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    </div>
                                </div>
                            </div>
                            <div class="flex space-x-2 mt-3">
                                <button onclick="filterUsers()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition duration-300">
                                    <i class="fas fa-search mr-2"></i>Search & Filter
                                </button>
                                <button onclick="clearUserFilters()" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition duration-300">
                                    <i class="fas fa-times mr-2"></i>Clear Filters
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div id="usersList" class="space-y-4">
                        <div class="text-center py-8">
                            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto"></div>
                            <p class="text-gray-500 mt-2">Loading users...</p>
                        </div>
                    </div>
                </div>
            `;
            
            // Load users
            await loadUsers();
        }
        
        async function loadUsers() {
            try {
                const token = localStorage.getItem('token');
                if (!token) {
                    document.getElementById('usersList').innerHTML = '<p class="text-red-500 text-center py-8">Authentication required</p>';
                    return;
                }
                
                let response = await fetch('http://localhost:8005/api/admin/users', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                // If token is invalid, try to refresh it
                if (response.status === 401) {
                    console.log('🔄 Token invalid, refreshing...');
                    const newToken = await refreshToken();
                    if (newToken) {
                        // Retry with new token
                        response = await fetch('http://localhost:8005/api/admin/users', {
                            headers: {
                                'Authorization': `Bearer ${newToken}`
                            }
                        });
                    }
                }
                
                if (response.ok) {
                    const data = await response.json();
                    displayUsers(data.users || []);
                } else if (response.status === 401) {
                    document.getElementById('usersList').innerHTML = '<p class="text-red-500 text-center py-8">Unauthorized access</p>';
                } else {
                    document.getElementById('usersList').innerHTML = '<p class="text-red-500 text-center py-8">Error loading users</p>';
                }
            } catch (error) {
                console.error('Error loading users:', error);
                document.getElementById('usersList').innerHTML = '<p class="text-red-500 text-center py-8">Error loading users</p>';
            }
        }
        
        function displayUsers(users) {
            const usersList = document.getElementById('usersList');
            if (!usersList) return;
            
            if (users.length === 0) {
                usersList.innerHTML = '<p class="text-gray-500 text-center py-8">No users found</p>';
                return;
            }
            
            usersList.innerHTML = users.map(user => `
                <div class="bg-white p-6 rounded-lg border border-gray-200 shadow-sm hover:shadow-md transition-shadow">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-4">
                            <div class="w-12 h-12 bg-gray-200 rounded-full flex items-center justify-center border border-gray-300">
                                <i class="fas fa-user text-gray-700"></i>
                            </div>
                            <div>
                                <h3 class="text-lg font-semibold text-gray-800">${user.name || 'Unknown'}</h3>
                                <p class="text-gray-600">${user.email}</p>
                                <div class="flex items-center space-x-2 mt-1">
                                    <span class="px-2 py-1 text-xs rounded-full ${user.role === 'admin' ? 'bg-purple-100 text-purple-800' : 'bg-blue-100 text-blue-800'}">
                                        ${user.role === 'admin' ? 'Admin' : 'Candidate'}
                                    </span>
                                    ${user.has_resume ? `<span class="px-2 py-1 text-xs rounded-full bg-green-100 text-green-800">Has Resume</span>` : ''}
                                    ${user.has_resume && user.role !== 'admin' ? `<span class="px-2 py-1 text-xs rounded-full bg-purple-100 text-purple-800 ml-2" id="ai-score-${user.email}">AI: Loading...</span>` : ''}
                                </div>
                            </div>
                        </div>
                        <div class="flex space-x-2">
                            ${user.has_resume && user.role !== 'admin' ? `
                                <button onclick="viewUserResume('${user.email}')" class="px-3 py-1 bg-blue-500 text-white text-sm rounded hover:bg-blue-600 transition duration-300">
                                    <i class="fas fa-eye mr-1"></i>View Resume
                                </button>
                            ` : ''}
                            ${user.role !== 'admin' ? `
                                <button onclick="deleteUser('${user.email}')" class="px-3 py-1 bg-red-500 text-white text-sm rounded hover:bg-red-600 transition duration-300">
                                    <i class="fas fa-trash mr-1"></i>Delete
                                </button>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `).join('');
            
            // Auto-generate AI scores for users with resumes
            users.forEach(user => {
                if (user.has_resume && user.role !== 'admin') {
                    setTimeout(() => {
                        generateAIScore(user.email);
                    }, 1000); // Delay to avoid overwhelming the server
                }
            });
        }

        // Resume viewing functions for User Management
        async function viewUserResume(userEmail) {
            try {
                const token = localStorage.getItem('token');
                if (!token) {
                    alert('Please login first');
                    showLoginModal();
                    return;
                }

                // Get user data to find resume file
                const userData = await getUserData(userEmail);
                if (!userData) {
                    alert('User not found.');
                    return;
                }

                // Get AI analysis data for the user
                const analysisResponse = await fetch(`http://localhost:8005/api/admin/ai-resume-analysis`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        email: userEmail
                    })
                });

                let analysisData = null;
                if (analysisResponse.ok) {
                    analysisData = await analysisResponse.json();
                }

                // Show beautiful popup with user details
                showResumeDetailsPopup(userData, analysisData);

            } catch (error) {
                console.error('Error viewing resume:', error);
                alert('Error loading resume details. Please try again.');
            }
        }

        // Show resume details popup
        function showResumeDetailsPopup(userData, analysisData) {
            console.log('User Data:', userData);
            console.log('Analysis Data:', analysisData);
            
            // EXTRACT SKILLS FROM ACTUAL RESUME DATA
            let skills = [];
            
            // Try to get skills from analysis data if available
            if (analysisData) {
                // Method 1: Direct extracted_skills (from actual resume data)
                if (analysisData.extracted_skills && Array.isArray(analysisData.extracted_skills) && analysisData.extracted_skills.length > 0) {
                    skills = analysisData.extracted_skills;
                }
                // Method 2: Skills object with extracted array
                else if (analysisData.skills && analysisData.skills.extracted && Array.isArray(analysisData.skills.extracted) && analysisData.skills.extracted.length > 0) {
                    skills = analysisData.skills.extracted;
                }
                // Method 3: Skills as direct array
                else if (analysisData.skills && Array.isArray(analysisData.skills) && analysisData.skills.length > 0) {
                    skills = analysisData.skills;
                }
                // Method 4: Skills as string
                else if (analysisData.skills && typeof analysisData.skills === 'string') {
                    skills = analysisData.skills.split(',').map(s => s.trim());
                }
            }
            
            // If no skills found, try to use user data skills
            if (skills.length === 0 && userData && userData.skills) {
                if (Array.isArray(userData.skills)) {
                    skills = userData.skills;
                } else if (typeof userData.skills === 'string') {
                    skills = userData.skills.split(',').map(s => s.trim());
                }
            }

            // EXTRACT EXPERIENCE FROM ACTUAL RESUME DATA
            let experience = 0;
            
            // Try to get experience from analysis data if available
            if (analysisData) {
                // Method 1: Direct extracted_experience (from actual resume data)
                if (analysisData.extracted_experience !== undefined && typeof analysisData.extracted_experience === 'number') {
                    experience = analysisData.extracted_experience;
                }
                // Method 2: Experience object with years
                else if (analysisData.experience && analysisData.experience.years && analysisData.experience.years > 0) {
                    experience = analysisData.experience.years;
                }
                // Method 3: Experience as direct number
                else if (analysisData.experience && typeof analysisData.experience === 'number' && analysisData.experience > 0) {
                    experience = analysisData.experience;
                }
                // Method 4: Try to get from AI analysis nested structure
                else if (analysisData.ai_analysis && analysisData.ai_analysis.experience) {
                    if (typeof analysisData.ai_analysis.experience === 'number' && analysisData.ai_analysis.experience > 0) {
                        experience = analysisData.ai_analysis.experience;
                    } else if (analysisData.ai_analysis.experience.years && analysisData.ai_analysis.experience.years > 0) {
                        experience = analysisData.ai_analysis.experience.years;
                    }
                }
            }
            
            // If still 0, try to extract from resume text
            if (experience === 0 && analysisData && analysisData.resume_text) {
                const text = analysisData.resume_text.toLowerCase();
                const yearsMatch = text.match(/(\d+)\s*(?:years?|yrs?)\s*(?:of\s*)?(?:experience|exp)/);
                if (yearsMatch) {
                    experience = parseInt(yearsMatch[1]);
                }
            }

            // EXTRACT ROLE FROM ACTUAL RESUME DATA
            let role = 'Developer'; // Default fallback
            
            // Try to get role from analysis data if available
            if (analysisData) {
                // Method 1: Direct extracted_role (from actual resume data)
                if (analysisData.extracted_role && typeof analysisData.extracted_role === 'string') {
                    role = analysisData.extracted_role;
                }
                // Method 2: Role object with title
                else if (analysisData.role && analysisData.role.title && analysisData.role.title !== 'Developer') {
                    role = analysisData.role.title;
                }
                // Method 3: Role as direct string
                else if (analysisData.role && typeof analysisData.role === 'string' && analysisData.role !== 'Developer') {
                    role = analysisData.role;
                }
                // Method 4: Try to get from AI analysis nested structure
                else if (analysisData.ai_analysis && analysisData.ai_analysis.role) {
                    if (typeof analysisData.ai_analysis.role === 'string' && analysisData.ai_analysis.role !== 'Developer') {
                        role = analysisData.ai_analysis.role;
                    } else if (analysisData.ai_analysis.role.title && analysisData.ai_analysis.role.title !== 'Developer') {
                        role = analysisData.ai_analysis.role.title;
                    }
                }
            }
            
            // Extract career stage from analysis data - BASED ON ACTUAL EXPERIENCE
            let careerStage = 'Entry Level'; // Default for fresher
            
            // Determine career stage based on actual experience
            if (experience >= 5) {
                careerStage = 'Senior Level';
            } else if (experience >= 3) {
                careerStage = 'Mid Career';
            } else if (experience >= 1) {
                careerStage = 'Junior Level';
            } else {
                careerStage = 'Entry Level';
            }
            
            // Override with AI analysis if available
            if (analysisData && analysisData.career_growth && analysisData.career_growth.stage) {
                careerStage = analysisData.career_growth.stage;
            }
            
            // Extract email from resume analysis data - PRIORITIZE RESUME EXTRACTION
            let extractedEmail = null;
            
            // Debug: Log analysis data to see what we're getting
            console.log('Analysis Data for email extraction:', analysisData);
            
            // First try to get extracted email from resume analysis
            if (analysisData && analysisData.extracted_email && analysisData.extracted_email !== null && analysisData.extracted_email !== '') {
                extractedEmail = analysisData.extracted_email;
                console.log('✅ Using extracted_email from analysis:', extractedEmail);
            } else {
                console.log('❌ No valid extracted_email in analysis data:', analysisData?.extracted_email);
                // If no extracted email, try to extract from resume text directly
                if (analysisData && analysisData.resume_text) {
                const emailPattern = /\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b/gi;
                const emailMatches = analysisData.resume_text.match(emailPattern);
                console.log('Email matches from resume text:', emailMatches);
                    if (emailMatches && emailMatches.length > 0) {
                        extractedEmail = emailMatches[0];
                        console.log('Using email from resume text regex:', extractedEmail);
                    }
                }
            }
            // If still no email, try one more time with a different approach
            if (!extractedEmail && analysisData && analysisData.resume_text) {
                console.log('🔄 Trying alternative email extraction from resume text...');
                const text = analysisData.resume_text;
                // Try a more comprehensive email pattern
                const emailPatterns = [
                    /\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b/gi,
                    /[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/g,
                    /[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}/gi
                ];
                
                for (let pattern of emailPatterns) {
                    const matches = text.match(pattern);
                    if (matches && matches.length > 0) {
                        extractedEmail = matches[0];
                        console.log('✅ Found email with alternative pattern:', extractedEmail);
                        break;
                    }
                }
            }
            
            // FORCE EMAIL EXTRACTION - If still no email, try to extract from any available text
            if (!extractedEmail) {
                console.log('🚨 FORCING email extraction from any available text...');
                // Try to get text from various sources
                const possibleTexts = [
                    analysisData?.resume_text,
                    analysisData?.raw_text,
                    analysisData?.content,
                    JSON.stringify(analysisData).substring(0, 2000) // Fallback to JSON string
                ];
                
                for (let text of possibleTexts) {
                    if (text && typeof text === 'string') {
                        const emailPattern = /\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b/gi;
                        const matches = text.match(emailPattern);
                        if (matches && matches.length > 0) {
                            // Filter out common test emails and prefer the one that looks like a real email
                            const realEmails = matches.filter(email => 
                                !email.includes('test') && 
                                !email.includes('example') && 
                                !email.includes('sample') &&
                                email.includes('.')
                            );
                            if (realEmails.length > 0) {
                                extractedEmail = realEmails[0];
                                console.log('✅ FORCED email extraction successful:', extractedEmail);
                                break;
                            } else if (matches.length > 0) {
                                extractedEmail = matches[0];
                                console.log('✅ FORCED email extraction (fallback):', extractedEmail);
                                break;
                            }
                        }
                    }
                }
            }
            
            // Only use profile email as last resort
            if (!extractedEmail) {
                extractedEmail = userData.email || 'Email not found in resume';
                console.log('Using fallback email:', extractedEmail);
            }
            
            console.log('Final extracted email:', extractedEmail);
            
            // If still default, try to extract from resume text
            if (role === 'Developer' && analysisData && analysisData.resume_text) {
                const text = analysisData.resume_text.toLowerCase();
                if (text.includes('full stack') || text.includes('fullstack')) {
                    role = 'Full Stack Developer';
                } else if (text.includes('frontend') || text.includes('front-end')) {
                    role = 'Frontend Developer';
                } else if (text.includes('backend') || text.includes('back-end')) {
                    role = 'Backend Developer';
                } else if (text.includes('java')) {
                    role = 'Java Developer';
                } else if (text.includes('python')) {
                    role = 'Python Developer';
                }
            }

            // Create popup HTML - smaller and more compact
            const popupHTML = `
                <div id="resumeDetailsPopup" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                    <div class="bg-white rounded-lg shadow-2xl max-w-md w-full mx-4 max-h-[70vh] overflow-y-auto">
                        <div class="bg-gradient-to-r from-blue-600 to-purple-600 text-white p-3 rounded-t-lg">
                            <div class="flex justify-between items-center">
                                <div class="flex items-center space-x-2">
                                    <button onclick="closeResumeDetailsPopup()" class="text-white hover:text-gray-200 text-lg font-bold mr-2">
                                        ←
                                    </button>
                                    <h2 class="text-lg font-bold">Resume Details</h2>
                                </div>
                                <button onclick="closeResumeDetailsPopup()" class="text-white hover:text-gray-200 text-lg font-bold">
                                    ×
                                </button>
                            </div>
                        </div>
                        
                        <div class="p-3 space-y-3">
                            <!-- Personal Information -->
                            <div class="bg-gray-50 rounded-lg p-2">
                                <h3 class="text-sm font-semibold text-gray-800 mb-1 flex items-center">
                                    <i class="fas fa-user-circle text-blue-500 mr-1 text-xs"></i>
                                    Personal Information
                                </h3>
                                <div class="space-y-1">
                                    <div>
                                        <label class="text-xs font-medium text-gray-600">Name</label>
                                        <p class="text-gray-800 font-semibold text-xs">${analysisData?.extracted_name || userData.name || 'Not specified'}</p>
                                    </div>
                                    <div>
                                        <label class="text-xs font-medium text-gray-600">Email</label>
                                        <p class="text-gray-800 font-semibold text-xs">${extractedEmail}</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Professional Information -->
                            <div class="bg-gray-50 rounded-lg p-2">
                                <h3 class="text-sm font-semibold text-gray-800 mb-1 flex items-center">
                                    <i class="fas fa-briefcase text-green-500 mr-1 text-xs"></i>
                                    Professional Information
                                </h3>
                                <div class="space-y-1">
                                    <div>
                                        <label class="text-xs font-medium text-gray-600">Role</label>
                                        <p class="text-gray-800 font-semibold text-xs">${role}</p>
                                    </div>
                                    <div>
                                        <label class="text-xs font-medium text-gray-600">Experience</label>
                                        <p class="text-gray-800 font-semibold text-xs">${experience} years</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Skills -->
                            <div class="bg-gray-50 rounded-lg p-2">
                                <h3 class="text-sm font-semibold text-gray-800 mb-1 flex items-center">
                                    <i class="fas fa-code text-purple-500 mr-1 text-xs"></i>
                                    Technical Skills
                                </h3>
                                <div class="flex flex-wrap gap-2">
                                    ${skills && skills.length > 0 ? skills.map(skill => `
                                        <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-xs font-medium border border-blue-200 shadow-sm">
                                            ${skill}
                                        </span>
                                    `).join('') : '<p class="text-red-500 text-sm font-medium">No skills extracted</p>'}
                                </div>
                            </div>

                            <!-- AI Analysis Summary -->
                            ${analysisData ? `
                            <div class="bg-gray-50 rounded-lg p-2">
                                <h3 class="text-sm font-semibold text-gray-800 mb-1 flex items-center">
                                    <i class="fas fa-robot text-orange-500 mr-1 text-xs"></i>
                                    AI Analysis Summary
                                </h3>
                                <div class="space-y-1">
                                    <div>
                                        <label class="text-xs font-medium text-gray-600">Market Readiness</label>
                                        <p class="text-gray-800 font-semibold text-xs">${analysisData.ai_insights?.market_readiness || 'Ready for senior fullstack roles'}</p>
                                    </div>
                                    <div>
                                        <label class="text-xs font-medium text-gray-600">Growth Potential</label>
                                        <p class="text-gray-800 font-semibold text-xs">${analysisData.ai_insights?.growth_potential || 'High - Good skill diversity'}</p>
                                    </div>
                                    <div>
                                        <label class="text-xs font-medium text-gray-600">Career Stage</label>
                                        <p class="text-gray-800 font-semibold text-xs">${careerStage}</p>
                                    </div>
                                </div>
                            </div>
                            ` : ''}

                            <!-- Actions -->
                            <div class="flex justify-end space-x-2 pt-2 border-t">
                                <button onclick="closeResumeDetailsPopup()" class="px-2 py-1 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition duration-300 text-xs">
                                    Close
                                </button>
                                <button onclick="openResumeFile('${userData.email}')" class="px-2 py-1 bg-green-500 text-white rounded-lg hover:bg-green-600 transition duration-300 text-xs">
                                    <i class="fas fa-eye mr-1"></i>View Resume
                                </button>
                                <button onclick="downloadUserResume('${userData.email}')" class="px-2 py-1 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition duration-300 text-xs">
                                    <i class="fas fa-download mr-1"></i>Download
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // Add popup to body
            document.body.insertAdjacentHTML('beforeend', popupHTML);
        }

        // Close resume details popup
        function closeResumeDetailsPopup() {
            const popup = document.getElementById('resumeDetailsPopup');
            if (popup) {
                popup.remove();
            }
        }

        // Open resume file in new tab
        async function openResumeFile(userEmail) {
            try {
                const token = localStorage.getItem('token');
                if (!token) {
                    alert('Please login first');
                    return;
                }

                // Get user data to find resume filename
                const userResponse = await fetch(`http://localhost:8005/api/admin/users`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (!userResponse.ok) {
                    throw new Error('Failed to fetch user data');
                }

                const usersData = await userResponse.json();
                const user = usersData.users.find(u => u.email === userEmail);
                
                if (!user || !user.resume_filename) {
                    alert('Resume not found for this user');
                    return;
                }

                // Open resume in new tab
                const resumeUrl = `http://localhost:8005/uploads/${user.resume_filename}`;
                window.open(resumeUrl, '_blank');

            } catch (error) {
                console.error('Error opening resume:', error);
                alert('Error opening resume. Please try again.');
            }
        }

        // Download resume file
        async function downloadUserResume(userEmail) {
            try {
                const token = localStorage.getItem('token');
                if (!token) {
                    alert('Please login first');
                    return;
                }

                // Get user data to find resume filename
                const userResponse = await fetch(`http://localhost:8005/api/admin/users`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (!userResponse.ok) {
                    throw new Error('Failed to fetch user data');
                }

                const usersData = await userResponse.json();
                const user = usersData.users.find(u => u.email === userEmail);
                
                if (!user || !user.resume_filename) {
                    alert('Resume not found for this user');
                    return;
                }

                // Create download link
                const resumeUrl = `http://localhost:8005/uploads/${user.resume_filename}`;
                const link = document.createElement('a');
                link.href = resumeUrl;
                link.download = user.resume_filename;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);

            } catch (error) {
                console.error('Error downloading resume:', error);
                alert('Error downloading resume. Please try again.');
            }
        }

        // Helper function to get user data
        async function getUserData(userEmail) {
            try {
                const token = localStorage.getItem('token');
                if (!token) return null;

                const response = await fetch(`http://localhost:8005/api/admin/users`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    const user = data.users.find(u => u.email === userEmail);
                    return user || null;
                }
                return null;
            } catch (error) {
                console.error('Error getting user data:', error);
                return null;
            }
        }

        // Auto AI Scoring function
        async function generateAIScore(userEmail) {
            try {
                const token = localStorage.getItem('token');
                if (!token) return;

                // Call admin AI analysis endpoint
                const response = await fetch(`http://localhost:8005/api/admin/ai-resume-analysis`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        email: userEmail
                    })
                });

                if (response.ok) {
                    const analysisData = await response.json();
                    
                    // Extract AI confidence score (0-1 scale, convert to percentage)
                    const aiScore = Math.round((analysisData.enhanced_score || analysisData.ai_insights?.confidence || 0.8) * 100);
                    
                    // Update the AI score badge with highlighted design
                    const scoreElement = document.getElementById(`ai-score-${userEmail}`);
                    if (scoreElement) {
                        scoreElement.innerHTML = `
                            <div class="flex items-center space-x-2 bg-gradient-to-r from-blue-50 to-purple-50 p-2 rounded-lg border border-blue-200 shadow-sm">
                                <div class="relative">
                                    <div class="w-10 h-10 rounded-full ${getScoreColor(aiScore)} flex items-center justify-center shadow-lg">
                                        <span class="score-text text-sm font-bold text-black">${aiScore}%</span>
                                    </div>
                                    <div class="absolute -top-1 -right-1 w-4 h-4 bg-yellow-400 rounded-full flex items-center justify-center shadow-sm">
                                        <i class="fas fa-star text-xs text-white"></i>
                                    </div>
                                </div>
                                <div class="flex flex-col">
                                    <span class="text-xs font-bold text-gray-800">AI Score</span>
                                    <span class="text-xs text-gray-600">${getScoreLevel(aiScore)}</span>
                                </div>
                            </div>
                        `;
                    }
                } else {
                    // Update with error state
                    const scoreElement = document.getElementById(`ai-score-${userEmail}`);
                    if (scoreElement) {
                        scoreElement.innerHTML = `
                            <div class="flex items-center space-x-2 bg-red-50 p-2 rounded-lg border border-red-200">
                                <div class="w-10 h-10 rounded-full bg-red-500 flex items-center justify-center">
                                    <i class="fas fa-exclamation-triangle text-white text-sm"></i>
                                </div>
                                <div class="flex flex-col">
                                    <span class="text-xs font-bold text-red-800">AI Error</span>
                                    <span class="text-xs text-red-600">Failed to analyze</span>
                                </div>
                            </div>
                        `;
                    }
                }

            } catch (error) {
                console.error('Error generating AI score:', error);
                
                // Update with error state
                const scoreElement = document.getElementById(`ai-score-${userEmail}`);
                if (scoreElement) {
                    scoreElement.textContent = 'AI: Error';
                    scoreElement.className = 'px-2 py-1 text-xs rounded-full ml-2 bg-red-100 text-red-800';
                }
            }
        }


        // Helper function to get score level
        function getScoreLevel(score) {
            if (score >= 90) return 'Excellent';
            if (score >= 80) return 'Very Good';
            if (score >= 70) return 'Good';
            if (score >= 60) return 'Fair';
            return 'Needs Improvement';
        }

        // Helper function to get score color with dark black background and white text
        function getScoreColor(score) {
            if (score >= 90) return 'bg-black text-white border-2 border-green-500 shadow-lg';
            if (score >= 80) return 'bg-black text-white border-2 border-blue-500 shadow-lg';
            if (score >= 70) return 'bg-black text-white border-2 border-yellow-500 shadow-lg';
            if (score >= 60) return 'bg-black text-white border-2 border-orange-500 shadow-lg';
            return 'bg-black text-white border-2 border-red-500 shadow-lg';
        }
        
        // Helper function to get status color for application status badges
        function getStatusColor(status) {
            switch(status.toLowerCase()) {
                case 'accepted':
                    return 'bg-green-100 text-green-800';
                case 'rejected':
                    return 'bg-red-100 text-red-800';
                case 'under_review':
                    return 'bg-yellow-100 text-yellow-800';
                case 'applied':
                    return 'bg-blue-100 text-blue-800';
                default:
                    return 'bg-gray-100 text-gray-800';
            }
        }
        
        async function deleteUser(userEmail) {
            if (!confirm(`Are you sure you want to delete user ${userEmail}? This action cannot be undone.`)) {
                return;
            }
            
            try {
                const token = localStorage.getItem('token');
                if (!token) return;
                
                const response = await fetch(`http://localhost:8005/api/admin/users/${userEmail}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.ok) {
                    alert('User deleted successfully!');
                    await loadUsers(); // Reload users list
                } else {
                    const error = await response.text();
                    alert('Error deleting user: ' + error);
                }
            } catch (error) {
                console.error('Error deleting user:', error);
                alert('Error deleting user. Please try again.');
            }
        }

        // User filtering functions with resume content search
        async function filterUsers() {
            try {
                const token = localStorage.getItem('token');
                if (!token) return;
                
                // Get filter values
                const search = document.getElementById('userSearchInput').value;
                const domain = document.getElementById('domainFilterInput').value;
                const minExp = document.getElementById('minExpInput').value;
                const maxExp = document.getElementById('maxExpInput').value;
                
                // Build query parameters
                const params = new URLSearchParams();
                console.log('🔍 Filter values:', { search, domain, minExp, maxExp });
                if (search) params.append('search', search);
                if (domain) params.append('domain', domain);
                if (minExp) params.append('experience_min', minExp);
                if (maxExp) params.append('experience_max', maxExp);
                console.log('🔍 Query params:', params.toString());
                
                // Show loading
                const usersList = document.getElementById('usersList');
                usersList.innerHTML = `
                    <div class="text-center py-8">
                        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto"></div>
                        <p class="text-gray-500 mt-2">Searching users...</p>
                    </div>
                `;
                
                // Fetch filtered users
                const response = await fetch(`http://localhost:8005/api/admin/users?${params}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (!response.ok) {
                    throw new Error('Failed to fetch users');
                }
                
                const data = await response.json();
                displayUsers(data.users);
                
                // Show search results message
                if (data.users.length === 0) {
                    usersList.innerHTML = '<p class="text-gray-500 text-center py-8">No users match the selected filters.</p>';
                }
                
            } catch (error) {
                console.error('Error filtering users:', error);
                loadUsers(); // Reload all users on error
            }
        }
        
        function clearUserFilters() {
            // Clear all filter inputs
            document.getElementById('userSearchInput').value = '';
            document.getElementById('domainFilterInput').value = '';
            document.getElementById('minExpInput').value = '';
            document.getElementById('maxExpInput').value = '';
            
            // Reload all users
            loadUsers();
        }

        
        async function showAdminAnalyticsSection() {
            document.getElementById('dashboardContent').innerHTML = `
                <div class="dashboard-card rounded-xl p-8 animate-fadeInUp">
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center space-x-3">
                            <div class="w-12 h-12 bg-purple-500 rounded-full flex items-center justify-center text-white text-xl">
                                <i class="fas fa-chart-bar"></i>
                            </div>
                            <h2 class="text-2xl font-bold text-gray-800">Analytics Dashboard</h2>
                        </div>
                        <button onclick="showAdminDashboard()" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition duration-300">
                            <i class="fas fa-arrow-left mr-2"></i>Back to Dashboard
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-6 rounded-lg border border-blue-200">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-600">Total Users</p>
                                    <p class="text-2xl font-bold text-blue-600" id="analyticsUsers">-</p>
                                </div>
                                <i class="fas fa-users text-blue-500 text-2xl"></i>
                            </div>
                        </div>
                        
                        <div class="bg-gradient-to-r from-green-50 to-emerald-50 p-6 rounded-lg border border-green-200">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-600">Total Jobs</p>
                                    <p class="text-2xl font-bold text-green-600" id="analyticsJobs">-</p>
                                </div>
                                <i class="fas fa-briefcase text-green-500 text-2xl"></i>
                            </div>
                        </div>
                        
                        <div class="bg-gradient-to-r from-orange-50 to-amber-50 p-6 rounded-lg border border-orange-200">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-600">Total Applications</p>
                                    <p class="text-2xl font-bold text-orange-600" id="analyticsApplications">-</p>
                                </div>
                                <i class="fas fa-file-alt text-orange-500 text-2xl"></i>
                            </div>
                        </div>
                        
                        <div class="bg-gradient-to-r from-purple-50 to-pink-50 p-6 rounded-lg border border-purple-200">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-600">Total Resumes</p>
                                    <p class="text-2xl font-bold text-purple-600" id="analyticsResumes">-</p>
                                </div>
                                <i class="fas fa-file-pdf text-purple-500 text-2xl"></i>
                            </div>
                        </div>
                        
                        <div class="bg-gradient-to-r from-red-50 to-rose-50 p-6 rounded-lg border border-red-200">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-600">Active Jobs</p>
                                    <p class="text-2xl font-bold text-red-600" id="analyticsActiveJobs">-</p>
                                </div>
                                <i class="fas fa-chart-line text-red-500 text-2xl"></i>
                            </div>
                        </div>
                        
                        <div class="bg-gradient-to-r from-teal-50 to-cyan-50 p-6 rounded-lg border border-teal-200">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-600">Application Rate</p>
                                    <p class="text-2xl font-bold text-teal-600" id="analyticsAppRate">-</p>
                                </div>
                                <i class="fas fa-percentage text-teal-500 text-2xl"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-8">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Application Status Breakdown</h3>
                        <div id="applicationStatusChart" class="grid grid-cols-2 md:grid-cols-5 gap-4">
                            <!-- Status breakdown will be loaded here -->
                        </div>
                    </div>
                </div>
            `;
            
            // Load analytics data
            loadAdminAnalytics();
        }
        
        async function loadAdminAnalytics() {
            try {
                const token = localStorage.getItem('token');
                if (!token) return;
                
                const response = await fetch('http://localhost:8005/api/admin/dashboard-stats', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    displayAdminAnalytics(data);
                }
            } catch (error) {
                console.error('Error loading analytics:', error);
            }
        }
        
        function displayAdminAnalytics(stats) {
            // Update main stats
            document.getElementById('analyticsUsers').textContent = stats.total_users;
            document.getElementById('analyticsJobs').textContent = stats.total_jobs;
            document.getElementById('analyticsApplications').textContent = stats.total_applications;
            document.getElementById('analyticsResumes').textContent = stats.total_resumes;
            document.getElementById('analyticsActiveJobs').textContent = stats.active_jobs;
            
            // Calculate application rate
            const appRate = stats.total_jobs > 0 ? ((stats.total_applications / stats.total_jobs) * 100).toFixed(1) : 0;
            document.getElementById('analyticsAppRate').textContent = appRate + '%';
            
            // Display application status breakdown
            const statusChart = document.getElementById('applicationStatusChart');
            if (statusChart) {
                const statusColors = {
                    'under_review': 'bg-yellow-100 text-yellow-800',
                    'accepted': 'bg-green-100 text-green-800',
                    'rejected': 'bg-red-100 text-red-800'
                };
                
                statusChart.innerHTML = Object.entries(stats.applications_by_status).map(([status, count]) => `
                    <div class="text-center p-4 rounded-lg ${statusColors[status] || 'bg-gray-100 text-gray-800'}">
                        <div class="text-2xl font-bold">${count}</div>
                        <div class="text-sm">${status.replace('_', ' ').toUpperCase()}</div>
                    </div>
                `).join('');
            }
        }
        
        // Load user's applications
        async function loadMyApplications() {
            try {
                console.log('Loading applications...');
                const token = localStorage.getItem('token');
                if (!token) {
                    console.log('No token found');
                    return;
                }
                
                const response = await fetch('http://localhost:8005/api/user-applications', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                console.log('Response status:', response.status);
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('Applications data:', data);
                    displayMyApplications(data.applications);
                } else {
                    console.error('Failed to load applications:', response.status);
                    const applicationsList = document.getElementById('myApplicationsList') || document.getElementById('rightApplicationsList');
                    if (applicationsList) {
                        applicationsList.innerHTML = '<div class="text-red-500">Error loading applications</div>';
                    }
                }
            } catch (error) {
                console.error('Error loading applications:', error);
                const applicationsList = document.getElementById('myApplicationsList') || document.getElementById('rightApplicationsList');
                if (applicationsList) {
                    applicationsList.innerHTML = '<div class="text-red-500">Error loading applications</div>';
                }
            }
        }
        
        // Display user's applications
        function displayMyApplications(applications) {
            console.log('Displaying applications:', applications);
            const applicationsList = document.getElementById('myApplicationsList') || document.getElementById('rightApplicationsList');
            if (!applicationsList) {
                console.error('Applications list element not found');
                return;
            }
            
            console.log('Found applications list element');
            
            // Update application counts
            updateApplicationCounts(applications);
            
            if (applications.length === 0) {
                console.log('No applications found');
                applicationsList.innerHTML = '<div class="text-gray-500">No applications submitted yet</div>';
                return;
            }
            
            applicationsList.innerHTML = applications.map(app => `
                <div class="bg-white p-4 rounded-lg border border-gray-200 mb-3">
                    <div class="flex justify-between items-start mb-2">
                        <h4 class="font-semibold text-gray-800">${app.job_title}</h4>
                        <span class="px-2 py-1 rounded-full text-xs font-medium ${getStatusColor(app.status)}">
                            ${app.status.replace('_', ' ').toUpperCase()}
                        </span>
                    </div>
                    <p class="text-sm text-gray-600 mb-1">${app.job_company} • ${app.job_location}</p>
                    <p class="text-xs text-gray-500">Applied: ${app.applied_date}</p>
                    ${app.updated_date ? `<p class="text-xs text-gray-500">Updated: ${app.updated_date}</p>` : ''}
                </div>
            `).join('');
        }
        
        // Update application counts
        function updateApplicationCounts(applications) {
            const totalCount = applications.length;
            const acceptedCount = applications.filter(app => app.status === 'accepted').length;
            const rejectedCount = applications.filter(app => app.status === 'rejected').length;
            
            console.log('Updating counts:', { totalCount, acceptedCount, rejectedCount });
            
            // Update total applications count
            const totalElements = document.querySelectorAll('.text-2xl.font-bold.text-blue-600');
            totalElements.forEach(el => {
                if (el.nextElementSibling && el.nextElementSibling.textContent.includes('Total Applications')) {
                    el.textContent = totalCount;
                    console.log('Updated total count to:', totalCount);
                }
            });
            
            // Update accepted count
            const acceptedElements = document.querySelectorAll('.text-2xl.font-bold.text-green-600');
            acceptedElements.forEach(el => {
                if (el.nextElementSibling && el.nextElementSibling.textContent.includes('Accepted')) {
                    el.textContent = acceptedCount;
                    console.log('Updated accepted count to:', acceptedCount);
                }
            });
            
            // Update rejected count
            const rejectedElements = document.querySelectorAll('.text-2xl.font-bold.text-red-600');
            rejectedElements.forEach(el => {
                if (el.nextElementSibling && el.nextElementSibling.textContent.includes('Rejected')) {
                    el.textContent = rejectedCount;
                    console.log('Updated rejected count to:', rejectedCount);
                }
            });
        }
        
        // Job search functions
        async function searchJobs() {
            const search = document.getElementById('jobSearch').value;
            const location = document.getElementById('jobLocation').value;
            const company = document.getElementById('jobCompany').value;
            const minSalary = document.getElementById('minSalary').value;
            const maxSalary = document.getElementById('maxSalary').value;
            const jobType = document.getElementById('jobType').value;
            
            const params = new URLSearchParams();
            if (search) params.append('search', search);
            if (location) params.append('location', location);
            if (company) params.append('company', company);
            if (minSalary) params.append('min_salary', minSalary);
            if (maxSalary) params.append('max_salary', maxSalary);
            if (jobType) params.append('job_type', jobType);
            
            try {
                const response = await fetch(`http://localhost:8005/api/jobs?${params.toString()}`);
                if (response.ok) {
                    const data = await response.json();
                    await displayJobs(data.jobs, 'jobsList');
                }
            } catch (error) {
                console.error('Error searching jobs:', error);
            }
        }
        
        async function searchJobsRight() {
            const search = document.getElementById('rightJobSearch').value;
            const location = document.getElementById('rightJobLocation').value;
            const company = document.getElementById('rightJobCompany').value;
            const minSalary = document.getElementById('rightMinSalary').value;
            const maxSalary = document.getElementById('rightMaxSalary').value;
            const jobType = document.getElementById('rightJobType').value;
            
            const params = new URLSearchParams();
            if (search) params.append('search', search);
            if (location) params.append('location', location);
            if (company) params.append('company', company);
            if (minSalary) params.append('min_salary', minSalary);
            if (maxSalary) params.append('max_salary', maxSalary);
            if (jobType) params.append('job_type', jobType);
            
            try {
                const response = await fetch(`http://localhost:8005/api/jobs?${params.toString()}`);
                if (response.ok) {
                    const data = await response.json();
                    await displayJobs(data.jobs, 'rightJobsList');
                }
            } catch (error) {
                console.error('Error searching jobs:', error);
            }
        }
        
        function clearFilters() {
            document.getElementById('jobSearch').value = '';
            document.getElementById('jobLocation').value = '';
            document.getElementById('jobCompany').value = '';
            document.getElementById('minSalary').value = '';
            document.getElementById('maxSalary').value = '';
            document.getElementById('jobType').value = '';
            loadJobs();
        }
        
        function clearFiltersRight() {
            document.getElementById('rightJobSearch').value = '';
            document.getElementById('rightJobLocation').value = '';
            document.getElementById('rightJobCompany').value = '';
            document.getElementById('rightMinSalary').value = '';
            document.getElementById('rightMaxSalary').value = '';
            document.getElementById('rightJobType').value = '';
            loadJobsRight();
        }
        
        // Load jobs function
        async function loadJobs() {
            try {
                const response = await fetch('http://localhost:8005/api/jobs');
                if (response.ok) {
                    const data = await response.json();
                    await displayJobs(data.jobs, 'jobsList');
                }
            } catch (error) {
                console.error('Error loading jobs:', error);
            }
        }
        
        async function loadJobsRight() {
            try {
                const response = await fetch('http://localhost:8005/api/jobs');
                if (response.ok) {
                    const data = await response.json();
                    await displayJobs(data.jobs, 'rightJobsList');
                }
            } catch (error) {
                console.error('Error loading jobs:', error);
            }
        }
        
        // Display jobs function
        async function displayJobs(jobs, containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            if (jobs.length === 0) {
                container.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <i class="fas fa-briefcase text-4xl mb-4"></i>
                        <p>No jobs found matching your criteria.</p>
                        <p class="text-sm">Try adjusting your search filters.</p>
                    </div>
                `;
                return;
            }
            
            // Get user applications to check which jobs are already applied
            let userApplications = [];
            try {
                const token = localStorage.getItem('token');
                if (token) {
                    const response = await fetch('http://localhost:8005/api/user-applications', {
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });
                    if (response.ok) {
                        const data = await response.json();
                        userApplications = data.applications || [];
                    }
                }
            } catch (error) {
                console.error('Error fetching user applications:', error);
            }
            
            // Create set of applied job IDs
            const appliedJobIds = new Set(userApplications.map(app => app.job_id));
            
            container.innerHTML = jobs.map(job => {
                const isApplied = appliedJobIds.has(job.id);
                const buttonClass = isApplied 
                    ? 'bg-green-600 text-white px-4 py-2 rounded-lg cursor-not-allowed transition duration-300'
                    : 'bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition duration-300';
                const buttonText = isApplied 
                    ? '<i class="fas fa-check mr-2"></i>Applied'
                    : '<i class="fas fa-paper-plane mr-2"></i>Apply Now';
                const buttonOnclick = isApplied 
                    ? '' 
                    : `onclick="applyForJob(${parseInt(job.id)})"`;
                
                return `
                <div class="bg-white p-6 rounded-lg border border-gray-200 hover:shadow-lg transition-shadow duration-300">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h3 class="text-xl font-bold text-gray-800 mb-2">${job.title}</h3>
                            <p class="text-gray-600 mb-1">${job.company}</p>
                            <p class="text-gray-500 text-sm">${job.location}</p>
                        </div>
                        <div class="text-right">
                                <div class="bg-yellow-100 border border-yellow-300 rounded-lg px-3 py-2 mb-2">
                                    <p class="text-yellow-800 font-bold text-lg">₹ ${job.salary_range}</p>
                                    <p class="text-yellow-600 text-xs">Salary</p>
                                </div>
                            <p class="text-gray-500 text-sm">${job.posted_date}</p>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <p class="text-gray-700 mb-2">${job.description.substring(0, 200)}...</p>
                        <div class="text-sm text-gray-600">
                            <strong>Requirements:</strong> ${job.requirements.substring(0, 150)}...
                        </div>
                    </div>
                    
                    <div class="flex justify-between items-center">
                        <div class="flex space-x-2">
                            <span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full">${job.job_type || 'Full Time'}</span>
                        </div>
                            <button ${buttonOnclick} class="${buttonClass}" ${isApplied ? 'disabled' : ''}>
                                ${buttonText}
                        </button>
                    </div>
                </div>
                `;
            }).join('');
        }
        
        // Apply for job function
        async function applyForJob(jobId) {
            try {
                // Ensure jobId is an integer
                jobId = parseInt(jobId);
                console.log('Applying for job ID:', jobId, 'Type:', typeof jobId);
                const token = localStorage.getItem('token');
                if (!token) {
                    alert('Please login to apply for jobs');
                    return;
                }
                
                const response = await fetch(`http://localhost:8005/api/apply/${jobId}`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.ok) {
                    alert('Application submitted successfully! You will receive an email confirmation.');
                    
                    // Update the apply button to show "Applied" state
                    updateApplyButtonState(jobId, true);
                    
                    // Refresh applications if on applications page
                    if (document.getElementById('myApplicationsList')) {
                        loadMyApplications();
                    }
                    
                    // Refresh jobs to show updated state
                    loadJobs();
                    loadJobsRight();
                } else {
                    const error = await response.text();
                    alert('Error: ' + error);
                }
            } catch (error) {
                console.error('Error applying for job:', error);
                alert('Error applying for job. Please try again.');
            }
        }
        
        // Update apply button state
        function updateApplyButtonState(jobId, isApplied) {
            const buttons = document.querySelectorAll(`button[onclick="applyForJob(${parseInt(jobId)})"]`);
            buttons.forEach(button => {
                if (isApplied) {
                    button.innerHTML = '<i class="fas fa-check mr-2"></i>Applied';
                    button.className = 'bg-green-600 text-white px-4 py-2 rounded-lg cursor-not-allowed transition duration-300';
                    button.disabled = true;
                }
            });
        }
     </script>
 </body>
 </html>















